---
title: أتمتة استقبال البيانات
---

# أتمتة استقبال البيانات

!!! abstract "نتائج التعلم"

    بنهاية هذه الجلسة العملية، ستكون قادرًا على:
    
    - فهم كيفية تحديد إضافات البيانات لمجموعة البيانات الخاصة بك لسير عمل استقبال البيانات
    - استقبال البيانات في wis2box باستخدام سكربت يستخدم عميل Python لـ MinIO
    - استقبال البيانات في wis2box بالوصول إلى MinIO عبر SFTP

## مقدمة

يستمع حاوية **wis2box-management** للأحداث من خدمة تخزين MinIO لتشغيل استقبال البيانات بناءً على الإضافات المُعدة لمجموعة البيانات الخاصة بك. هذا يتيح لك تحميل البيانات إلى دلو MinIO وتشغيل سير عمل wis2box لنشر البيانات على وسيط WIS2.

تحدد الإضافات الوحدات البرمجية بلغة Python التي يتم تحميلها بواسطة حاوية **wis2box-management** وتحدد كيفية تحويل البيانات ونشرها.

في التمرين السابق يجب أن تكون قد أنشأت مجموعة بيانات باستخدام القالب `surface-based-observations/synop` والذي يشمل الإضافات التالية:

<img alt="تعيينات البيانات" src="../../assets/img/wis2box-data-mappings.png" width="800">

عندما يتم تحميل ملف إلى MinIO، سيقوم wis2box بمطابقة الملف مع مجموعة البيانات عندما يحتوي مسار الملف على معرف مجموعة البيانات (`metadata_id`) وسيحدد الإضافات المستخدمة بناءً على امتداد الملف ونمط الملف المحدد في تعيينات المجموعة.

في الجلسات السابقة، قمنا بتشغيل سير عمل استقبال البيانات باستخدام وظائف سطر الأوامر في wis2box، والتي تقوم بتحميل البيانات إلى تخزين MinIO في المسار الصحيح.

يمكن إجراء نفس الخطوات برمجيًا باستخدام أي برنامج عميل لـ MinIO أو S3، مما يتيح لك أتمتة استقبال بياناتك كجزء من سير عملك التشغيلي.

بدلاً من ذلك، يمكنك أيضًا الوصول إلى MinIO باستخدام بروتوكول SFTP لتحميل البيانات وتشغيل سير عمل استقبال البيانات.

## التحضير

قم بتسجيل الدخول إلى جهاز الطالب الافتراضي الخاص بك باستخدام عميل SSH الخاص بك (PuTTY أو غيره).

تأكد من أن wis2box يعمل:

```bash
cd ~/wis2box-1.0.0rc1/
python3 wis2box-ctl.py start
python3 wis2box-ctl.py status
```

تأكد من أن MQTT Explorer يعمل ومتصل بنسختك. إذا كنت لا تزال متصلاً من الجلسة السابقة، قم بمسح أي رسائل سابقة قد تكون قد تلقيتها من الطابور.
يمكن القيام بذلك إما بقطع الاتصال وإعادة الاتصال أو بالنقر على أيقونة سلة المهملات للموضوع المحدد.

تأكد من أن لديك متصفح ويب مفتوح مع لوحة تحكم Grafana لنسختك بالانتقال إلى `http://<your-host>:3000`

وتأكد من أن لديك علامة تبويب ثانية مفتوحة مع واجهة المستخدم MinIO على `http://<your-host>:9001`. تذكر أنك بحاجة إلى تسجيل الدخول باستخدام `WIS2BOX_STORAGE_USER` و `WIS2BOX_STORAGE_PASSWORD` المحددين في ملف `wis2box.env` الخاص بك.

## التمرين 1: إعداد سكربت Python لاستقبال البيانات في MinIO

في هذا التمرين سنستخدم عميل Python لـ MinIO لنسخ البيانات إلى MinIO.

يوفر MinIO عميل Python يمكن تثبيته على النحو التالي:

```bash
pip3 install minio
```

على جهاز الطالب الافتراضي الخاص بك، سيكون حزمة 'minio' لـ Python مثبتة بالفعل.

انتقل إلى الدليل `exercise-materials/data-ingest-exercises`؛ يحتوي هذا الدليل على سكربت نموذجي `copy_file_to_incoming.py` يستخدم عميل Python لـ MinIO لنسخ ملف إلى MinIO.

حاول تشغيل السكربت لنسخ ملف البيانات النموذجي `csv-aws-example.csv` إلى دلو `wis2box-incoming` في MinIO" على النحو التالي:

```bash
cd ~/exercise-materials/data-ingest-exercises
python3 copy_file_to_incoming.py csv-aws-example.csv
```

!!! note

    ستحصل على خطأ لأن السكربت لم يتم تكوينه بعد للوصول إلى نقطة النهاية MinIO على wis2box الخاص بك.

يحتاج السكربت إلى معرفة نقطة النهاية الصحيحة للوصول إلى MinIO على wis2box الخاص بك. إذا كان wis2box يعمل على مضيفك، فإن نقطة النهاية MinIO متاحة على `http://<your-host>:9000`. يحتاج السكربت أيضًا إلى تحديث كلمة المرور الخاصة بالتخزين والمسار في دلو MinIO لتخزين البيانات.

!!! question "تحديث السكربت واستقبال بيانات CSV"
    
    قم بتحرير السكربت `copy_file_to_incoming.py` لمعالجة الأخطاء، باستخدام إحدى الطرق التالية:
    - من سطر الأوامر: استخدم محرر النصوص `nano` أو `vim` لتحرير السكربت
    - باستخدام WinSCP: ابدأ اتصالًا جديدًا باستخدام بروتوكول الملف `SCP` ونفس بيانات الاعتماد كعميل SSH الخاص بك. انتقل إلى الدليل `exercise-materials/data-ingest-exercises` وقم بتحرير `copy_file_to_incoming.py` باستخدام محرر النصوص المدمج
    
    تأكد من أنك:

    - حددت نقطة النهاية MinIO الصحيحة لمضيفك
    - قدمت كلمة المرور الصحيحة لتخزين MinIO الخاص بك
    - قدمت المسار الصحيح في دلو MinIO لتخزين البيانات

    أعد تشغيل السكربت لاستقبال ملف البيانات النموذجي `csv-aws-example.csv` في MinIO:

    ```bash
    python3 copy_file_to_incoming.py csv-aws-example.csv
    ```

    وتأكد من حل الأخطاء.

يمكنك التحقق من أن البيانات تم تحميلها بشكل صحيح من خلال التحقق من واجهة المستخدم MinIO ومعرفة ما إذا كانت البيانات النموذجية متوفرة في الدليل الصحيح في دلو `wis2box-incoming`.

يمكنك استخدام لوحة تحكم Grafana للتحقق من حالة سير عمل استقبال البيانات.

وأخيرًا، يمكنك استخدام MQTT Explorer للتحقق مما إذا تم نشر الإشعارات للبيانات التي قمت باستقبالها. يجب أن ترى أن البيانات CSV تم تحويلها إلى تنسيق BUFR وأن إشعار بيانات WIS2 تم نشره بعنوان URL "قياسي" لتمكين تنزيل بيانات BUFR.

## التمرين 2: استقبال البيانات الثنائية

بعد ذلك، سنحاول استقبال البيانات الثنائية بتنسيق BUFR باستخدام عميل Python لـ MinIO.

يمكن لـ wis2box استقبال البيانات الثنائية بتنسيق BUFR باستخدام الإضافة `wis2box.data.bufr4.ObservationDataBUFR` المضمنة في wis2box.

سيقوم هذا الإضافة بتقسيم ملف BUFR إلى رسائل BUFR فردية ونشر كل رسالة إلى وسيط MQTT. إذا لم يتم تعريف المحطة لرسالة BUFR المقابلة في بيانات المحطة لـ wis2box، فلن يتم نشر الرسالة.

نظرًا لأنك استخدمت القالب `surface-based-observations/synop` في الجلسة السابقة، فإن تعيينات بياناتك تشمل الإضافة `FM-12 data converted to BUFR` لتعيينات المجموعة. يقوم هذا الإضافة بتحميل الوحدة البرمجية `wis2box.data.synop2bufr.ObservationDataSYNOP2BUFR` لاستقبال البيانات.

!!! question "استقبال البيانات الثنائية بتنسيق BUFR"

    قم بتشغيل الأمر التالي لنسخ ملف البيانات الثنائية `bufr-example.bin` إلى دلو `wis2box-incoming` في MinIO:

    ```bash
    python3 copy_file_to_incoming.py bufr-example.bin
    ```

تحقق من لوحة تحكم Grafana و MQTT Explorer لمعرفة ما إذا كانت البيانات الاختبارية قد تم استقبالها ونشرها بنجاح وإذا رأيت أي أخطاء، حاول حلها.

!!! question "تحقق من استقبال البيانات"

    كم عدد الرسائل التي تم نشرها إلى وسيط MQTT لهذه العينة من البيانات؟

??? success "انقر لكشف الإجابة"

    إذا قمت باستقبال ونشر عينة البيانات الأخيرة بنجاح، يجب أن تكون قد تلقيت 10 إشعارات جديدة على وسيط MQTT الخاص بـ wis2box. يتوافق كل إشعار مع بيانات لمحطة واحدة لطابع زمني لملاحظة واحدة.

    يقوم الإضافة `wis2box.data.bufr4.ObservationDataBUFR` بتقسيم ملف BUFR إلى رسائل BUFR فردية ونشر رسالة واحدة لكل محطة وطابع زمني للملاحظة.

## التمرين 3: استقبال بيانات SYNOP بتنسيق ASCII

في الجلسة السابقة استخدمنا نموذج SYNOP في **wis2box-webapp** لاستقبال بيانات SYNOP بتنسيق ASCII. يمكنك أيضًا استقبال بيانات SYNOP بتنسيق ASCII عن طريق تحميل البيانات إلى MinIO.

في الجلسة السابقة يجب أن تكون قد أنشأت مجموعة بيانات تشمل الإضافة 'FM-12 data converted to BUFR' لتعيينات المجموعة:

<img alt="تعيينات المجموعة" src="../../assets/img/wis2box-data-mappings.png" width="800">

يقوم هذا الإضافة بتحميل الوحدة البرمجية `wis2box.data.synop2bufr.ObservationDataSYNOP2BUFR` لاستقبال البيانات.

حاول استخدام عميل Python لـ MinIO لاستقبال بيانات الاختبار `synop-202307.txt` و `synop-202308.txt` في نسخة wis2box الخاصة بك.

لاحظ أن الملفين يحتويان على نفس المحتوى، ولكن اسم الملف مختلف. يتم استخدام اسم الملف لتحديد تاريخ عينة البيانات.

يعتمد الإضافة synop2bufr على نمط ملف لاستخراج التاريخ من اسم الملف. يتم استخدام المجموعة الأولى في التع