---
title: إدخال البيانات للنشر
---

# إدخال البيانات للنشر

!!! abstract "الأهداف التعليمية"

    بنهاية هذه الجلسة العملية، ستكون قادرًا على:
    
    - تشغيل سير عمل `wis2box` عن طريق تحميل البيانات إلى MinIO باستخدام سطر الأوامر، واجهة MinIO على الويب، SFTP، أو باستخدام سكربت Python.
    - الوصول إلى لوحة تحكم Grafana لمراقبة حالة إدخال البيانات وعرض سجلات مثيل `wis2box` الخاص بك.
    - عرض إشعارات بيانات WIS2 التي ينشرها `wis2box` الخاص بك باستخدام MQTT Explorer.

## المقدمة

في نظام WIS2، يتم مشاركة البيانات في الوقت الفعلي باستخدام إشعارات بيانات WIS2 التي تحتوي على رابط "قياسي" يمكن من خلاله تنزيل البيانات.

لتشغيل سير عمل البيانات في عقدة WIS2 باستخدام برنامج `wis2box`، يجب تحميل البيانات إلى الحاوية **wis2box-incoming** في **MinIO**، مما يؤدي إلى بدء سير عمل `wis2box`. ينتج عن هذه العملية نشر البيانات عبر إشعار بيانات WIS2. بناءً على تعيينات البيانات التي تم تكوينها في مثيل `wis2box` الخاص بك، قد يتم تحويل البيانات إلى تنسيق BUFR قبل نشرها.

في هذا التمرين، سنستخدم ملفات بيانات نموذجية لتشغيل سير عمل `wis2box` و**نشر إشعارات بيانات WIS2** لمجموعة البيانات التي قمت بتكوينها في الجلسة العملية السابقة.

خلال التمرين، سنراقب حالة إدخال البيانات باستخدام **لوحة تحكم Grafana** و**MQTT Explorer**. تستخدم لوحة تحكم Grafana بيانات من Prometheus وLoki لعرض حالة `wis2box` الخاص بك، بينما يسمح لك MQTT Explorer برؤية إشعارات بيانات WIS2 التي ينشرها مثيل `wis2box` الخاص بك.

يرجى ملاحظة أن `wis2box` سيحول البيانات النموذجية إلى تنسيق BUFR قبل نشرها إلى وسيط MQTT، وفقًا لتعيينات البيانات التي تم تكوينها مسبقًا في مجموعة البيانات الخاصة بك. في هذا التمرين، سنركز على الطرق المختلفة لتحميل البيانات إلى مثيل `wis2box` الخاص بك والتحقق من نجاح الإدخال والنشر. سيتم تغطية تحويل البيانات لاحقًا في الجلسة العملية [أدوات تحويل البيانات](./data-conversion-tools.md).

## التحضير

تستخدم هذه الجلسة مجموعتي بيانات تم إعدادهما في الجلسة العملية "تكوين مجموعات البيانات في wis2box":

1. مجموعة بيانات الطقس/الملاحظات السطحية/التقارير السطحية (synop) المعرفة مسبقًا.

2. مجموعة بيانات مخصصة تم إنشاؤها باستخدام القالب "Other" (مثال GEPS).

يتطلب إدخال **الطقس/الملاحظات السطحية/التقارير السطحية (synop)** تكوين بيانات المحطات في تطبيق `wis2box-webapp`، كما هو موضح في الجلسة العملية [تكوين بيانات المحطات](./configuring-station-metadata.md).

بالنسبة لمجموعة البيانات **other** المستخدمة في هذا التدريب، يتم اختيار المكون الإضافي للبيانات العامة بدون تحويل لنشر ملفات GRIB2 دون تحويل. نظرًا لأن مجموعة البيانات التدريبية هذه لا تمثل ملاحظات المحطات، فلا يلزم تكوين المحطات. تأكد من أن امتداد الملف هو .grib2 وأن تعبير regex لنمط الملف يطابق أسماء ملفات البيانات الخاصة بك.

في عمليات WIS2 الفعلية، إذا كانت مجموعة البيانات التي تم إنشاؤها باستخدام القالب **other** تهدف إلى نشر بيانات ملاحظات المحطات، فيجب إنشاء بيانات المحطات وتكوينها بنفس الطريقة كما هو الحال بالنسبة لـ *الملاحظات السطحية/التقارير السطحية (synop)*.

تأكد من أنه يمكنك تسجيل الدخول إلى جهاز الطالب الافتراضي الخاص بك باستخدام عميل SSH (مثل PuTTY).

تأكد من أن `wis2box` يعمل:

```bash
cd ~/wis2box/
python3 wis2box-ctl.py start
python3 wis2box-ctl.py status
```

تأكد من أن MQTT Explorer يعمل ومتصل بمثيلك باستخدام بيانات الاعتماد العامة `everyone/everyone` مع اشتراك في الموضوع `origin/a/wis2/#`.

تأكد من فتح متصفح ويب يحتوي على لوحة تحكم Grafana لمثيلك عن طريق الانتقال إلى `http://YOUR-HOST:3000`.

## إعداد بيانات المثال

انسخ الدليل `exercise-materials/data-ingest-exercises` إلى الدليل الذي حددته كـ `WIS2BOX_HOST_DATADIR` في ملف `wis2box.env` الخاص بك:

```bash
cp -r ~/exercise-materials/data-ingest-exercises ~/wis2box-data/
```

!!! note
    يتم تركيب `WIS2BOX_HOST_DATADIR` كـ `/data/wis2box/` داخل حاوية `wis2box-management` بواسطة ملف `docker-compose.yml` المضمن في دليل `wis2box`.
    
    يتيح ذلك مشاركة البيانات بين المضيف والحاوية.

## إضافة محطة الاختبار (للبيانات القائمة على ملاحظات المحطات فقط)

دعونا نستخدم مجموعة بيانات الطقس/الملاحظات السطحية/التقارير السطحية (synop) المعرفة مسبقًا والتي تم إنشاؤها سابقًا في الجلسة العملية (./configuring-wis2box-datasdets.md)، وهي مثال جيد يعتمد على ملاحظات المحطات الحقيقية.

أضف المحطة ذات المعرف WIGOS `0-20000-0-64400` إلى مثيل `wis2box` الخاص بك باستخدام محرر المحطات في تطبيق `wis2box-webapp`.

استرجع المحطة من OSCAR:

<img alt="oscar-station" src="/../assets/img/webapp-test-station-oscar-search.png" width="600">

أضف المحطة إلى مجموعات البيانات التي أنشأتها للنشر على "../surface-based-observations/synop" واحفظ التغييرات باستخدام رمز المصادقة الخاص بك:

<img alt="webapp-test-station" src="/../assets/img/webapp-test-station-save.png" width="800">

يرجى ملاحظة أنه يمكنك إزالة هذه المحطة من مجموعة البيانات الخاصة بك بعد الجلسة العملية.

## اختبار إدخال البيانات من سطر الأوامر

في هذا التمرين، سنستخدم الأمر `wis2box data ingest` لتحميل البيانات إلى MinIO.

تأكد من أنك في دليل `wis2box` وقم بتسجيل الدخول إلى حاوية **wis2box-management**:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

تحقق من توفر بيانات المثال التالية في الدليل `/data/wis2box/` داخل حاوية **wis2box-management**:

```bash
ls -lh /data/wis2box/data-ingest-exercises/synop_202412030900.txt
```

!!! question "إدخال البيانات باستخدام `wis2box data ingest`"

    نفذ الأمر التالي لإدخال ملف بيانات المثال إلى مثيل `wis2box` الخاص بك:

    ```bash
    wis2box data ingest -p /data/wis2box/data-ingest-exercises/synop_202412030900.txt --metadata-id urn:wmo:md:not-my-centre:synop-test
    ```

    هل تم إدخال البيانات بنجاح؟ إذا لم يكن كذلك، ما هي رسالة الخطأ، وكيف يمكنك إصلاحها؟

??? success "اضغط للكشف عن الإجابة"

    لم يتم إدخال البيانات **بنجاح**. يجب أن ترى الرسالة التالية:

    ```bash
    Error: metadata_id=urn:wmo:md:not-my-centre:synop-test not found in data mappings
    ```

    تشير رسالة الخطأ إلى أن معرف البيانات الوصفية الذي قدمته لا يتطابق مع أي من مجموعات البيانات التي قمت بتكوينها في مثيل `wis2box` الخاص بك.

    قدم معرف البيانات الوصفية الصحيح الذي يتطابق مع مجموعة البيانات التي أنشأتها في الجلسة العملية السابقة وكرر أمر إدخال البيانات حتى ترى الإخراج التالي:

    ```bash 
    Processing /data/wis2box/data-ingest-exercises/synop_202412030900.txt
    Done
    ```

انتقل إلى وحدة التحكم MinIO في متصفحك وتحقق مما إذا تم تحميل الملف `synop_202412030900.txt` إلى الحاوية `wis2box-incoming`. يجب أن ترى دليلًا جديدًا باسم مجموعة البيانات التي قدمتها في خيار `--metadata-id`، وداخل هذا الدليل ستجد الملف `synop_202412030900.txt`:

<img alt="minio-wis2box-incoming-dataset-folder" src="/../assets/img/minio-data-ingest-test-data.png" width="800">

!!! note
    قام الأمر `wis2box data ingest` بتحميل الملف إلى الحاوية `wis2box-incoming` في MinIO داخل دليل يحمل اسم معرف البيانات الوصفية الذي قدمته.

انتقل إلى لوحة تحكم Grafana في متصفحك وتحقق من حالة إدخال البيانات.

!!! question "تحقق من حالة إدخال البيانات على Grafana"
    
    انتقل إلى لوحة تحكم Grafana على **http://your-host:3000** وتحقق من حالة إدخال البيانات في متصفحك.
    
    كيف يمكنك معرفة ما إذا تم إدخال البيانات ونشرها بنجاح؟

??? success "اضغط للكشف عن الإجابة"
    
    إذا قمت بإدخال البيانات بنجاح، يجب أن ترى ما يلي:
    
    <img alt="grafana_data_ingest" src="/../assets/img/grafana_data-ingest-test.png" width="400">  
    
    إذا لم ترَ ذلك، يرجى التحقق من رسائل التحذير أو الأخطاء المعروضة في أسفل لوحة التحكم وحاول حلها.

!!! question "تحقق من وسيط MQTT لإشعارات WIS2"
    
    انتقل إلى MQTT Explorer وتحقق مما إذا كان بإمكانك رؤية رسالة إشعار بيانات WIS2 للبيانات التي قمت بإدخالها للتو.
    
    كم عدد إشعارات بيانات WIS2 التي تم نشرها بواسطة `wis2box` الخاص بك؟
    
    كيف يمكنك الوصول إلى محتوى البيانات التي يتم نشرها؟

??? success "اضغط للكشف عن الإجابة"

    يجب أن ترى إشعار بيانات WIS2 واحدًا تم نشره بواسطة `wis2box`.

    للوصول إلى محتوى البيانات التي يتم نشرها، يمكنك توسيع بنية الموضوع لرؤية المستويات المختلفة للرسالة حتى تصل إلى المستوى الأخير ومراجعة محتوى الرسالة.

يحتوي محتوى الرسالة على قسم "links" مع مفتاح "rel" بقيمة "canonical" ومفتاح "href" يحتوي على عنوان URL لتنزيل البيانات. سيكون عنوان URL بالتنسيق `http://YOUR-HOST/data/...`.

يرجى ملاحظة أن تنسيق البيانات هو BUFR، وستحتاج إلى محلل BUFR لعرض محتوى البيانات. يتم استخدام تنسيق BUFR كتنسيق ثنائي من قبل خدمات الأرصاد الجوية لتبادل البيانات. قامت الإضافات البرمجية داخل `wis2box` بتحويل البيانات إلى تنسيق BUFR قبل نشرها.

بعد الانتهاء من هذا التمرين، قم بالخروج من حاوية **wis2box-management**:

```bash
exit
```

## تحميل البيانات باستخدام SFTP (اختياري)

يمكن الوصول إلى خدمة MinIO في `wis2box` أيضًا عبر SFTP. يتم ربط خادم SFTP الخاص بـ MinIO بالمنفذ 8022 على المضيف (حيث يتم استخدام المنفذ 22 لـ SSH).

في هذا التمرين، سنوضح كيفية استخدام WinSCP لتحميل البيانات إلى MinIO باستخدام SFTP.

يمكنك إعداد اتصال جديد في WinSCP كما هو موضح في لقطة الشاشة التالية:

<img alt="winscp-sftp-connection" src="/../assets/img/winscp-sftp-login.png" width="400">

يتم تعريف بيانات الاعتماد لاتصال SFTP بواسطة `WIS2BOX_STORAGE_USERNAME` و `WIS2BOX_STORAGE_PASSWORD` في ملف `wis2box.env` الخاص بك، وهي نفس بيانات الاعتماد التي استخدمتها للاتصال بواجهة MinIO.

عند تسجيل الدخول، ستظهر لك الحاويات (buckets) المستخدمة بواسطة `wis2box` في MinIO:

<img alt="winscp-sftp-bucket" src="/../assets/img/winscp-buckets.png" width="600">

يمكنك التنقل إلى حاوية `wis2box-incoming` ثم إلى المجلد الخاص بمجموعة البيانات الخاصة بك. سترى الملفات التي قمت بتحميلها في التمارين السابقة:

<img alt="winscp-sftp-incoming-path" src="/../assets/img/winscp-incoming-data-path.png" width="600">

!!! question "تحميل البيانات باستخدام SFTP"

    قم بتنزيل ملف العينة هذا إلى جهاز الكمبيوتر المحلي الخاص بك:

    [synop_202503030900.txt](./../sample-data/synop_202503030900.txt) (انقر بزر الماوس الأيمن واختر "حفظ باسم" لتنزيل الملف).

    ثم قم بتحميله إلى مسار مجموعة البيانات الواردة في MinIO باستخدام جلسة SFTP الخاصة بك في WinSCP.

    تحقق من لوحة معلومات Grafana ومستكشف MQTT لمعرفة ما إذا تم استيعاب البيانات ونشرها بنجاح.

??? success "انقر للكشف عن الإجابة"

    يجب أن ترى إشعار بيانات جديد لـ WIS2 تم نشره لمحطة الاختبار `0-20000-0-64400`، مما يشير إلى أن البيانات تم استيعابها ونشرها بنجاح.

    <img alt="grafana_data_ingest" src="/../assets/img/grafana_data-ingest-test3.png" width="400"> 

    إذا استخدمت المسار الخطأ، فسترى رسالة خطأ في السجلات.

## تحميل البيانات باستخدام سكربت Python (اختياري)

في هذا التمرين، سنستخدم عميل Python الخاص بـ MinIO لنسخ البيانات إلى MinIO.

يوفر MinIO عميل Python يمكن تثبيته كما يلي:

```bash
pip3 install minio
```

على جهاز الطالب الافتراضي الخاص بك، ستكون حزمة 'minio' الخاصة بـ Python مثبتة بالفعل.

في دليل `exercise-materials/data-ingest-exercises`، ستجد سكربت مثال باسم `copy_file_to_incoming.py` يمكن استخدامه لنسخ الملفات إلى MinIO.

حاول تشغيل السكربت لنسخ ملف بيانات العينة `synop_202501030900.txt` إلى حاوية `wis2box-incoming` في MinIO كما يلي:

```bash
cd ~/wis2box-data/data-ingest-exercises
python3 copy_file_to_incoming.py synop_202501030900.txt
```

!!! note

    ستظهر لك رسالة خطأ لأن السكربت غير مهيأ للوصول إلى نقطة النهاية الخاصة بـ MinIO على `wis2box` الخاص بك.

يحتاج السكربت إلى معرفة نقطة النهاية الصحيحة للوصول إلى MinIO على `wis2box` الخاص بك. إذا كان `wis2box` يعمل على مضيفك، فإن نقطة النهاية الخاصة بـ MinIO متاحة على `http://YOUR-HOST:9000`. كما يحتاج السكربت إلى تحديث كلمة مرور التخزين الخاصة بك والمسار في حاوية MinIO لتخزين البيانات.

!!! question "تحديث السكربت واستيعاب بيانات CSV"
    
    قم بتحرير السكربت `copy_file_to_incoming.py` لمعالجة الأخطاء باستخدام إحدى الطرق التالية:
    - من سطر الأوامر: استخدم محرر النصوص `nano` أو `vim` لتحرير السكربت.
    - باستخدام WinSCP: ابدأ اتصالاً جديدًا باستخدام بروتوكول الملف `SCP` ونفس بيانات الاعتماد الخاصة بعميل SSH الخاص بك. انتقل إلى الدليل `wis2box-data/data-ingest-exercises` وقم بتحرير `copy_file_to_incoming.py` باستخدام محرر النصوص المدمج.

    تأكد من أنك:

    - تحدد نقطة النهاية الصحيحة لـ MinIO على مضيفك.
    - توفر كلمة مرور التخزين الصحيحة لمثيل MinIO الخاص بك.
    - توفر المسار الصحيح في حاوية MinIO لتخزين البيانات.

    أعد تشغيل السكربت لاستيعاب ملف بيانات العينة `synop_202501030900.txt` في MinIO:

    ```bash
    python3 ~/wis2box-data/ ~/wis2box-data/synop_202501030900.txt
    ```

    تأكد من حل الأخطاء.

بمجرد أن تتمكن من تشغيل السكربت بنجاح، سترى رسالة تشير إلى أن الملف تم نسخه إلى MinIO، ويجب أن ترى إشعارات بيانات منشورة بواسطة مثيل `wis2box` الخاص بك في مستكشف MQTT.

يمكنك أيضًا التحقق من لوحة معلومات Grafana لمعرفة ما إذا تم استيعاب البيانات ونشرها بنجاح.

الآن بعد أن أصبح السكربت يعمل، يمكنك محاولة نسخ ملفات أخرى إلى MinIO باستخدام نفس السكربت.

!!! question "استيعاب البيانات الثنائية بتنسيق BUFR"

    قم بتشغيل الأمر التالي لنسخ ملف البيانات الثنائية `bufr-example.bin` إلى حاوية `wis2box-incoming` في MinIO:

    ```bash
    python3 copy_file_to_incoming.py bufr-example.bin
    ```

تحقق من لوحة معلومات Grafana ومستكشف MQTT لمعرفة ما إذا تم استيعاب بيانات الاختبار ونشرها بنجاح. إذا رأيت أي أخطاء، حاول حلها.

!!! question "التحقق من استيعاب البيانات"

    كم عدد الرسائل التي تم نشرها إلى وسيط MQTT لهذه العينة من البيانات؟

??? success "انقر للكشف عن الإجابة"

    سترى أخطاء تم الإبلاغ عنها في Grafana لأن المحطات في ملف BUFR غير معرفة في قائمة المحطات الخاصة بمثيل `wis2box` الخاص بك. 
    
    إذا تم تعريف جميع المحطات المستخدمة في ملف BUFR في مثيل `wis2box` الخاص بك، يجب أن ترى 10 رسائل منشورة إلى وسيط MQTT. كل إشعار يتوافق مع بيانات لمحطة واحدة ولطابع زمني واحد للمراقبة.

    يقوم المكون الإضافي `wis2box.data.bufr4.ObservationDataBUFR` بتقسيم ملف BUFR إلى رسائل BUFR فردية وينشر رسالة واحدة لكل محطة وطابع زمني للمراقبة.

## تحميل البيانات باستخدام واجهة MinIO على الويب 

في طرق الاستيعاب الثلاثة الأولى، استخدمنا باستمرار مجموعة البيانات القائمة على المحطات (synop) وبيانات المراقبة المرتبطة بها. في هذا القسم، سنقدم طريقة رابعة — واحدة من أكثر الطرق شيوعًا. هنا، سنعمل مع مجموعة بيانات أخرى ونستوعب بيانات GEPS باستخدام واجهة MinIO على الويب، التي تتيح تحميل وتنزيل البيانات مباشرة عبر متصفح الويب.

### تسجيل الدخول إلى متصفح MinIO

افتح واجهة MinIO على الويب (عادةً ما تكون متاحة على http://localhost:9001).

يمكن العثور على بيانات الاعتماد `WIS2BOX_STORAGE_USERNAME` و `WIS2BOX_STORAGE_PASSWORD` في ملف `wis2box.env`.

### التنقل إلى حاوية wis2box-incoming

حدد الحاوية `wis2box-incoming` وانقر على "إنشاء مسار جديد". يجب أن يتطابق اسم الدليل مع معرف البيانات الوصفية لمجموعة البيانات الخاصة بك. 

لأغراض هذا التدريب، استخدم مجموعة بيانات GEPS التي تم إنشاؤها مسبقًا، لذا قم بإنشاء الدليل:

```bash
urn:wmo:md:nl-knmi-test:customized-geps-dataset-wis2-training
```

### تحميل ملفات بيانات GEPS

ادخل إلى الدليل الذي تم إنشاؤه حديثًا، وانقر على "تحميل"، وحدد ملفات بيانات GEPS المحلية لتحميلها.

<img alt="minio-incoming-path" src="/../assets/img/minio-incoming-data-GEPS.png" width="800">

### التحقق من نجاح التحميل باستخدام مستكشف MQTT

بعد التحميل، تحقق باستخدام مستكشف MQTT للتأكد من أن البيانات تم نشرها بنجاح.

إذا لم يكن التحميل ناجحًا، يرجى التحقق من التالي:

1. تحقق من المكون الإضافي الذي تم تكوينه لمجموعة بيانات GEPS. قد يمنع عدم تطابق بين اسم الملف والتعبير العادي (regex) المكون الاستيعاب. قم بتعديل التعبير العادي أو إعادة تسمية ملفات البيانات لتتطابق.

2. أعد تشغيل `wis2box` وكرر عملية التحميل.

بمجرد نشر البيانات بنجاح، سترى رسالة تأكيد مشابهة لما يلي:

<img alt="minio-incoming-path" src="/../assets/img/minio-incoming-data-path-publish.png" width="800">

!!! question "إعادة تحميل البيانات باستخدام واجهة MinIO على الويب"

    انتقل إلى واجهة MinIO على الويب في متصفحك وتصفح إلى حاوية `wis2box-incoming`. سترى الملف `Z_NAFP_C_BABJ_20250818000000_P_CMA-GEPS-GLB-024` الذي قمت بتحميله في التمارين السابقة.

    انقر على الملف، وستحصل على خيار تنزيله:

    <img alt="minio-wis2box-incoming-dataset-folder" src="/../assets/img/minio-download.png" width="800">

    يمكنك تنزيل هذا الملف وإعادة تحميله إلى نفس المسار في MinIO لإعادة تشغيل سير عمل `wis2box`.

تحقق من لوحة معلومات Grafana وMQTT Explorer لمعرفة ما إذا تم استيعاب البيانات ونشرها بنجاح.

??? success "اضغط للكشف عن الإجابة"

سترى رسالة تشير إلى أن `wis2box` قد نشر هذه البيانات بالفعل:

```bash
ERROR - Data already published for Z_NAFP_C_BABJ_20250818000000_P_CMA-GEPS-GLB-024-grib2; not publishing
```

هذا يوضح أن سير عمل البيانات قد تم تشغيله، ولكن لم يتم إعادة نشر البيانات. لن يقوم `wis2box` بنشر نفس البيانات مرتين.

بالنسبة **لمجموعة بيانات أخرى**:

## الخلاصة

!!! success "تهانينا!"
في هذه الجلسة العملية، تعلمت كيفية:

- تشغيل سير عمل `wis2box` عن طريق تحميل البيانات إلى `MinIO` باستخدام طرق مختلفة.
- تصحيح الأخطاء الشائعة في عملية استيعاب البيانات باستخدام لوحة معلومات Grafana وسجلات مثيل `wis2box` الخاص بك.
- مراقبة إشعارات بيانات `WIS2` التي ينشرها `wis2box` الخاص بك في لوحة معلومات Grafana وMQTT Explorer.