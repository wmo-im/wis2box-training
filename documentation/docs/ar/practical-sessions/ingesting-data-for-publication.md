---
title: إدخال البيانات للنشر
---

# إدخال البيانات للنشر

!!! abstract "الأهداف التعليمية"

    بنهاية هذه الجلسة العملية، ستكون قادرًا على:
    
    - تشغيل سير عمل `wis2box` عن طريق تحميل البيانات إلى MinIO باستخدام واجهة MinIO على الويب، أو SFTP، أو باستخدام سكربت Python.
    - الوصول إلى لوحة تحكم Grafana لمراقبة حالة إدخال البيانات وعرض سجلات مثيل `wis2box` الخاص بك.
    - عرض إشعارات بيانات WIS2 التي تم نشرها بواسطة `wis2box` باستخدام MQTT Explorer.

## المقدمة

في نظام WIS2، يتم مشاركة البيانات في الوقت الفعلي باستخدام إشعارات بيانات WIS2 التي تحتوي على رابط "قياسي" يمكن من خلاله تنزيل البيانات.

لتشغيل سير عمل البيانات في عقدة WIS2 باستخدام برنامج `wis2box`، يجب تحميل البيانات إلى الحاوية **wis2box-incoming** في **MinIO**، مما يؤدي إلى بدء سير عمل `wis2box`. ينتج عن هذه العملية نشر البيانات عبر إشعار بيانات WIS2. بناءً على تعيينات البيانات التي تم تكوينها في مثيل `wis2box` الخاص بك، قد يتم تحويل البيانات إلى تنسيق BUFR قبل نشرها.

في هذا التمرين، سنستخدم ملفات بيانات تجريبية لتشغيل سير عمل `wis2box` و**نشر إشعارات بيانات WIS2** لمجموعة البيانات التي قمت بتكوينها في الجلسة العملية السابقة.

أثناء التمرين، سنراقب حالة إدخال البيانات باستخدام **لوحة تحكم Grafana** و**MQTT Explorer**. تستخدم لوحة تحكم Grafana بيانات من Prometheus وLoki لعرض حالة `wis2box` الخاص بك، بينما يتيح لك MQTT Explorer رؤية إشعارات بيانات WIS2 التي تم نشرها بواسطة مثيل `wis2box` الخاص بك.

لاحظ أن `wis2box` سيحول البيانات التجريبية إلى تنسيق BUFR قبل نشرها إلى وسيط MQTT، وفقًا لتعيينات البيانات التي تم تكوينها مسبقًا في مجموعة البيانات الخاصة بك. في هذا التمرين، سنركز على الطرق المختلفة لتحميل البيانات إلى مثيل `wis2box` الخاص بك والتحقق من نجاح الإدخال والنشر. سيتم تغطية تحويل البيانات لاحقًا في الجلسة العملية [أدوات تحويل البيانات](./data-conversion-tools.md).

## التحضير

تستخدم هذه القسم مجموعة البيانات الخاصة بـ "surface-based-observations/synop" و"other" التي تم إنشاؤها مسبقًا في الجلسة العملية [تكوين مجموعات البيانات في wis2box](./configuring-wis2box-datasets.md).

كما يتطلب معرفة بتكوين المحطات في **wis2box-webapp**، كما هو موضح في الجلسة العملية [تكوين بيانات المحطات](./configuring-station-metadata.md).

تأكد من أنه يمكنك تسجيل الدخول إلى جهاز الطالب الافتراضي الخاص بك باستخدام عميل SSH (مثل PuTTY).

تأكد من أن `wis2box` يعمل:

```bash
cd ~/wis2box/
python3 wis2box-ctl.py start
python3 wis2box-ctl.py status
```

تأكد من أن MQTT Explorer يعمل ومتصل بمثيلك باستخدام بيانات الاعتماد العامة `everyone/everyone` مع اشتراك في الموضوع `origin/a/wis2/#`.

تأكد من أن لديك متصفح ويب مفتوحًا مع لوحة تحكم Grafana لمثيلك عن طريق الانتقال إلى `http://YOUR-HOST:3000`.

### تحضير بيانات تجريبية

انسخ الدليل `exercise-materials/data-ingest-exercises` إلى الدليل الذي قمت بتعريفه كـ `WIS2BOX_HOST_DATADIR` في ملف `wis2box.env` الخاص بك:

```bash
cp -r ~/exercise-materials/data-ingest-exercises ~/wis2box-data/
```

!!! note
    يتم تركيب `WIS2BOX_HOST_DATADIR` كـ `/data/wis2box/` داخل حاوية `wis2box-management` بواسطة ملف `docker-compose.yml` المضمن في دليل `wis2box`.
    
    يتيح لك ذلك مشاركة البيانات بين المضيف والحاوية.

## إدخال البيانات باستخدام واجهة MinIO

أولاً، سنستخدم واجهة MinIO على الويب، والتي تتيح لك تنزيل وتحميل البيانات إلى MinIO باستخدام متصفح الويب.

### الوصول إلى واجهة MinIO

افتح واجهة MinIO على الويب (عادةً متوفرة على http://your-localhost:9001).

يمكن العثور على بيانات الاعتماد WIS2BOX_STORAGE_USERNAME وWIS2BOX_STORAGE_PASSWORD في ملف `wis2box.env`.

### الإدخال والنشر باستخدام Universal plugin

قم بتنزيل بيانات العينة العامة لهذا التمرين من الرابط أدناه إلى بيئتك المحلية:  
[geps_202508180000.grib2] (../sample-data/geps_202508180000.grib2) 

حدد الحاوية `wis2box-incoming` وانقر على "Create new path". يجب أن يتطابق اسم الدليل مع معرف البيانات الوصفية لمجموعة البيانات "other" التي قمت بإنشائها مسبقًا في الجلسة العملية [تكوين مجموعات البيانات في wis2box](./configuring-wis2box-datasets.md). لذا في هذه الحالة، يرجى إنشاء الدليل:

```bash
urn:wmo:md:nl-knmi-test:customized-geps-dataset-wis2-training
```

ادخل إلى الدليل الذي تم إنشاؤه حديثًا، وانقر على "Upload"، وحدد [geps_202508180000.grib2] (../sample-data/geps_202508180000.grib2)  الذي قمت بتنزيله إلى جهازك المحلي مسبقًا.

بعد التحميل، تحقق باستخدام MQTT Explorer للتأكد من أن البيانات تم نشرها بنجاح.

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/mqtt-explorer-wis2-notification-geps-sample.png" width="800">

!!! question "إعادة تسمية الملف إلى sample-geps-data.grib2"

    قم بتحميل الملف الذي تمت إعادة تسميته باستخدام واجهة الويب إلى نفس المسار في MinIO كما في الملف السابق.

    هل سيتم نشر الملف الذي تمت إعادة تسميته بنجاح؟ لماذا أو لماذا لا؟

??? success "انقر للكشف عن الإجابة"

    لا، لأنه عند تغيير اسم البيانات إلى "sample-geps-data.grib2"، فلن يتبع قاعدة التعبير النمطي.

    <img alt="Metadata Editor: title, description, keywords" src="/../assets/img/mqtt-explorer-wis2-notification-geps-regex-error.png" width="800">
    
    عند تحميل البيانات، يجب أن تتوافق أسماء الملفات مع اتفاقية التسمية المطلوبة التي يحددها تعبير نمطي:

    ```bash
    ^.*?_(\d{8}).*?\..*$
    ```

    يفرض هذا النمط أن يحتوي كل اسم ملف على:

    شرطة سفلية (_) يتبعها مباشرة سلسلة تاريخ مكونة من 8 أرقام بتنسيق YYYYMMDD (على سبيل المثال، 20250904).

    على سبيل المثال، الأسماء التالية صالحة:

    1. *Z_NAFP_C_BABJ_20250904_P_CMA-GEPS-GLB-024.grib2*

    2. *forecast_20250904.grib2*

    3. *sample-geps_20250101_data.grib2*

    لن يتم قبول اسم مثل sample-geps-data.grib2، لأنه لا يحتوي على تاريخ مكون من 8 أرقام.

!!! question "تغيير امتداد الملف من .grib2 إلى .bufr4 (دون تغيير المحتوى الداخلي للملف)"

    قم بتحميل الملف الذي تم تغيير اسمه باستخدام واجهة الويب إلى نفس المسار في MinIO كما في الملف السابق.

    هل سيتم نشر الملف الذي تم تغيير اسمه بنجاح؟ لماذا أو لماذا لا؟

??? success "انقر للكشف عن الإجابة"

    لا، لأنه عند تغيير تنسيق البيانات من "grib2" إلى "bufr4"، فلن يتبع قاعدة امتداد الملف التي قمت بتعريفها عند إنشاء مجموعة البيانات.

    <img alt="Metadata Editor: title, description, keywords" src="/../assets/img/mqtt-explorer-wis2-notification-geps-file-extension-error.png" width="800">
    
    عند تحميل البيانات باستخدام Universal plugin، يجب أن يحتوي الملف على امتداد الملف الصحيح كما هو محدد في تكوين مجموعة البيانات. يضمن هذا المتطلب أن عملية الإدخال يمكنها التعرف على تنسيق الملف ومعالجته بشكل صحيح. على سبيل المثال، إذا تم تكوين مجموعة البيانات لملفات grib2، فسيتم قبول الملفات التي تنتهي بـ .grib2 فقط. استخدام امتداد غير صحيح (مثل .txt أو .bin) سيؤدي إلى رفض الملف وعدم نشره.

!!! question "إعادة تحميل البيانات باستخدام واجهة MinIO على الويب"

    انتقل إلى واجهة MinIO على الويب في متصفحك وتصفح إلى الحاوية `wis2box-incoming`. سترى الملف `Z_NAFP_C_BABJ_20250818000000_P_CMA-GEPS-GLB-024.grib2` الذي قمت بتحميله في التمارين السابقة.

    انقر على الملف، وستحصل على خيار تنزيله:

    <img alt="minio-wis2box-incoming-dataset-folder" src="/../assets/img/minio-download.png" width="800">

    يمكنك تنزيل هذا الملف وإعادة تحميله إلى نفس المسار في MinIO لإعادة تشغيل سير عمل `wis2box`.

    تحقق من لوحة تحكم Grafana وMQTT Explorer لمعرفة ما إذا تم إدخال البيانات ونشرها بنجاح.

??? success "انقر للكشف عن الإجابة"

    سترى رسالة تشير إلى أن `wis2box` قد نشر هذه البيانات بالفعل:

    ```bash
    ERROR - Data already published for Z_NAFP_C_BABJ_20250818000000_P_CMA-GEPS-GLB-024-grib2; not publishing
    ``` 
    
    يوضح هذا أن سير عمل البيانات قد تم تشغيله، ولكن لم يتم إعادة نشر البيانات. لن يقوم `wis2box` بنشر نفس البيانات مرتين.

### الإدخال والنشر باستخدام synop2bufr-plugin

قم بتنزيل بيانات العينة الخاصة بـ `synop` [synop_202502040900.txt](../sample-data/synop_202502040900.txt) لهذا التمرين من الرابط أدناه إلى بيئتك المحلية:

اختر الحاوية `wis2box-incoming` وانقر على "Create new path". يجب أن يتطابق اسم الدليل مع معرف البيانات الوصفية لمجموعة بيانات "surface-based-observations/synop" التي قمت بإنشائها مسبقًا في جلسة العمل العملية [Configuring Datasets in wis2box](./configuring-wis2box-datasets.md). لذلك، في هذه الحالة، يرجى إنشاء الدليل التالي:

```bash
urn:wmo:md:nl-knmi-test:synop-dataset-wis2-training
```

ادخل إلى الدليل الذي أنشأته حديثًا، انقر على "Upload"، وحدد الملف [synop_202502040900.txt](../sample-data/synop_202502040900.txt) الذي قمت بتنزيله إلى جهازك المحلي ثم قم برفعه.

!!! question "هل تلقيت إشعارًا جديدًا يشير إلى أن البيانات قد تم نشرها؟ لماذا؟"

??? success "انقر للكشف عن الإجابة"

    لا. في لوحة التحكم الخاصة بـ Grafana سترى خطأ يشير إلى فشل الإدخال:

    <img alt="grafana_data_ingest" src="/../assets/img/grafana_data-ingest-error.png" width="800"> 

    عند استخدام قالب مجموعة بيانات `synop` مع الإضافات الافتراضية لـ `synop` (لبيانات CSV وTXT وBUFR SYNOP)، يجب أن تتضمن كل سجل معرف محطة صالح. يفشل الإدخال إذا لم تكن المحطة معروفة في مثيل `wis2box` الخاص بك. لذلك، يجب إضافة المحطة أولاً قبل نشر بيانات SYNOP.

    الآن، دعنا نضيف محطة اختبار لهذا التمرين.

    أضف المحطة بمعرف WIGOS `0-20000-0-64400` إلى مثيل `wis2box` الخاص بك باستخدام محرر المحطات في `wis2box-webapp`.

    استرجع المحطة من OSCAR:

    <img alt="oscar-station" src="/../assets/img/webapp-test-station-oscar-search.png" width="600">

    أضف المحطة إلى مجموعات البيانات التي أنشأتها للنشر على "../surface-based-observations/synop" واحفظ التغييرات باستخدام رمز المصادقة الخاص بك:

    <img alt="webapp-test-station" src="/../assets/img/webapp-test-station-save.png" width="800">

    لاحظ أنه يمكنك إزالة هذه المحطة من مجموعة البيانات الخاصة بك بعد الجلسة العملية.

بعد الانتهاء من تكوين البيانات الوصفية للمحطة، تحقق باستخدام `MQTT Explorer` للتأكد من أن البيانات قد تم نشرها بنجاح. إذا رأيت الإشعار أدناه، فهذا يعني أنك قمت بنشر بيانات العينة `synop` بنجاح.

<img alt="webapp-test-station" src="/../assets/img/mqtt-explorer-wis2box-notification-synop-sample.png" width="800">

## إدخال البيانات باستخدام Python (اختياري)

في هذا التمرين، سنستخدم عميل Python الخاص بـ MinIO لنسخ البيانات إلى MinIO.

يوفر MinIO عميل Python يمكن تثبيته كما يلي:

```bash
pip3 install minio
```

على الجهاز الافتراضي الخاص بك، ستكون حزمة 'minio' لـ Python مثبتة بالفعل.

في دليل `exercise-materials/data-ingest-exercises`، ستجد سكربت مثال باسم `copy_file_to_incoming.py` يمكن استخدامه لنسخ الملفات إلى MinIO.

حاول تشغيل السكربت لنسخ ملف بيانات العينة `synop_202501030900.txt` إلى حاوية `wis2box-incoming` في MinIO كما يلي:

```bash
cd ~/wis2box-data/data-ingest-exercises
python3 copy_file_to_incoming.py synop_202501030900.txt
```

!!! note

    ستظهر لك رسالة خطأ لأن السكربت غير مهيأ للوصول إلى نقطة النهاية الخاصة بـ MinIO على مثيل `wis2box` الخاص بك.

يحتاج السكربت إلى معرفة نقطة النهاية الصحيحة للوصول إلى MinIO على مثيل `wis2box` الخاص بك. إذا كان `wis2box` يعمل على مضيفك، فإن نقطة النهاية الخاصة بـ MinIO متاحة على `http://YOUR-HOST:9000`. كما يحتاج السكربت إلى تحديث كلمة مرور التخزين الخاصة بك والمسار في حاوية MinIO لتخزين البيانات.

!!! question "تحديث السكربت وإدخال بيانات CSV"

    قم بتحرير السكربت `copy_file_to_incoming.py` لمعالجة الأخطاء باستخدام إحدى الطرق التالية:
    - من سطر الأوامر: استخدم محرر النصوص `nano` أو `vim` لتحرير السكربت.
    - باستخدام WinSCP: ابدأ اتصالاً جديدًا باستخدام بروتوكول الملف `SCP` ونفس بيانات الاعتماد الخاصة بعميل SSH الخاص بك. انتقل إلى دليل `wis2box-data/data-ingest-exercises` وقم بتحرير `copy_file_to_incoming.py` باستخدام محرر النصوص المدمج.

    تأكد من أنك:

    - تحدد نقطة النهاية الصحيحة لـ MinIO لمضيفك.
    - توفر كلمة مرور التخزين الصحيحة لمثيل MinIO الخاص بك.
    - توفر المسار الصحيح في حاوية MinIO لتخزين البيانات.

    أعد تشغيل السكربت لإدخال ملف بيانات العينة `synop_202501030900.txt` إلى MinIO:

    ```bash
    python3 ~/wis2box-data/ ~/wis2box-data/synop_202501030900.txt
    ```

    تأكد من حل الأخطاء.

بمجرد أن تتمكن من تشغيل السكربت بنجاح، سترى رسالة تشير إلى أن الملف تم نسخه إلى MinIO، ويجب أن ترى إشعارات البيانات التي تم نشرها بواسطة مثيل `wis2box` الخاص بك في `MQTT Explorer`.

يمكنك أيضًا التحقق من لوحة التحكم في Grafana لمعرفة ما إذا تم إدخال البيانات ونشرها بنجاح.

الآن بعد أن أصبح السكربت يعمل، يمكنك محاولة نسخ ملفات أخرى إلى MinIO باستخدام نفس السكربت.

!!! question "إدخال بيانات ثنائية بتنسيق BUFR"

    قم بتشغيل الأمر التالي لنسخ ملف البيانات الثنائية `bufr-example.bin` إلى حاوية `wis2box-incoming` في MinIO:

    ```bash
    python3 copy_file_to_incoming.py bufr-example.bin
    ```

تحقق من لوحة التحكم في Grafana و`MQTT Explorer` لمعرفة ما إذا تم إدخال بيانات الاختبار ونشرها بنجاح. إذا رأيت أي أخطاء، حاول حلها.

!!! question "التحقق من إدخال البيانات"

    كم عدد الرسائل التي تم نشرها إلى وسيط MQTT لعينة البيانات هذه؟

??? success "انقر للكشف عن الإجابة"

    سترى أخطاء تم الإبلاغ عنها في Grafana لأن المحطات في ملف BUFR غير معرفة في قائمة المحطات الخاصة بمثيل `wis2box` الخاص بك.

    إذا كانت جميع المحطات المستخدمة في ملف BUFR معرفة في مثيل `wis2box` الخاص بك، يجب أن ترى 10 رسائل تم نشرها إلى وسيط MQTT. كل إشعار يتوافق مع بيانات لمحطة واحدة في وقت مراقبة واحد.

    يقوم المكون الإضافي `wis2box.data.bufr4.ObservationDataBUFR` بتقسيم ملف BUFR إلى رسائل BUFR فردية وينشر رسالة واحدة لكل محطة ووقت مراقبة.

## إدخال البيانات عبر SFTP (اختياري)

يمكن الوصول إلى خدمة MinIO في `wis2box` أيضًا عبر SFTP. يتم ربط خادم SFTP الخاص بـ MinIO بالمنفذ 8022 على المضيف (المنفذ 22 مخصص لـ SSH).

في هذا التمرين، سنوضح كيفية استخدام WinSCP لتحميل البيانات إلى MinIO باستخدام SFTP.

يمكنك إعداد اتصال جديد في WinSCP كما هو موضح في لقطة الشاشة التالية:

<img alt="winscp-sftp-connection" src="/../assets/img/winscp-sftp-login.png" width="400">

يتم تعريف بيانات الاعتماد لاتصال SFTP بواسطة `WIS2BOX_STORAGE_USERNAME` و`WIS2BOX_STORAGE_PASSWORD` في ملف `wis2box.env` الخاص بك وهي نفس بيانات الاعتماد التي استخدمتها للاتصال بواجهة MinIO.

عند تسجيل الدخول، سترى الحاويات المستخدمة بواسطة `wis2box` في MinIO:

<img alt="winscp-sftp-bucket" src="/../assets/img/winscp-buckets.png" width="600">

يمكنك التنقل إلى حاوية `wis2box-incoming` ثم إلى المجلد الخاص بمجموعة البيانات الخاصة بك. سترى الملفات التي قمت بتحميلها في التمارين السابقة:

<img alt="winscp-sftp-incoming-path" src="/../assets/img/winscp-incoming-data-path.png" width="600">

!!! question "تحميل البيانات باستخدام SFTP"

    قم بتنزيل ملف العينة هذا إلى جهاز الكمبيوتر المحلي الخاص بك:

    [synop_202503030900.txt](./../sample-data/synop_202503030900.txt) (انقر بزر الماوس الأيمن واختر "حفظ باسم" لتنزيل الملف).

    ثم قم بتحميله إلى مسار مجموعة البيانات الواردة في MinIO باستخدام جلسة SFTP الخاصة بك في WinSCP.

    تحقق من لوحة التحكم في Grafana و`MQTT Explorer` لمعرفة ما إذا تم إدخال البيانات ونشرها بنجاح.

??? success "انقر للكشف عن الإجابة"

    يجب أن ترى إشعار بيانات جديد لـ WIS2 تم نشره لمحطة الاختبار `0-20000-0-64400`، مما يشير إلى أن البيانات قد تم إدخالها ونشرها بنجاح.

    <img alt="grafana_data_ingest" src="/../assets/img/grafana_data-ingest-test3.png" width="400"> 

    إذا استخدمت المسار الخطأ، سترى رسالة خطأ في السجلات.

## الخاتمة

!!! success "تهانينا!"
    في هذه الجلسة العملية، تعلمت كيفية:

    - تشغيل سير عمل `wis2box` عن طريق تحميل البيانات إلى MinIO باستخدام طرق مختلفة.
    - تصحيح الأخطاء الشائعة في عملية إدخال البيانات باستخدام لوحة التحكم في Grafana وسجلات مثيل `wis2box` الخاص بك.
    - مراقبة إشعارات بيانات WIS2 التي تم نشرها بواسطة `wis2box` في لوحة التحكم في Grafana و`MQTT Explorer`.