---
title: إعداد مجموعة بيانات موصى بها مع التحكم في الوصول
---

# إعداد مجموعة بيانات موصى بها مع التحكم في الوصول

!!! abstract "نتائج التعلم"
    بنهاية هذه الجلسة العملية، ستكون قادرًا على:

    - إنشاء مجموعة بيانات جديدة بسياسة بيانات "موصى بها"
    - إضافة رمز وصول إلى مجموعة البيانات
    - التحقق من أن مجموعة البيانات لا يمكن الوصول إليها بدون رمز الوصول
    - إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات
    - إضافة ملف ترخيص مخصص مستضاف على مثيل wis2box الخاص بك

## المقدمة

تُشارك البيانات على WIS2 وفقًا لسياسة البيانات الموحدة للمنظمة العالمية للأرصاد الجوية (WMO Unified Data Policy) التي تصف فئتين من البيانات:

- **core**: بيانات تُقدَّم مجانًا وبدون قيود، بدون تكلفة وبدون شروط على الاستخدام.
- **recommended**: بيانات قد تُقدَّم بشروط على الاستخدام و/أو تخضع لترخيص.

البيانات التي تُشارك كـ "موصى بها":

- قد تخضع لشروط على الاستخدام وإعادة الاستخدام.
- قد يتم تطبيق ضوابط الوصول على البيانات.
- لا يتم تخزينها مؤقتًا بواسطة خدمات التخزين المؤقت العالمية لـ WIS2.
- يجب أن تحتوي على رابط إلى ترخيص يحدد شروط استخدام البيانات المضمنة في بيانات الاكتشاف الوصفية.

سيتطلب محرر مجموعة البيانات في wis2box-webapp منك تقديم رابط ترخيص عند اختيار سياسة البيانات "موصى بها". اختياريًا، يمكنك إضافة رمز وصول إلى مجموعة البيانات لتقييد الوصول إليها.

في هذه الجلسة العملية، ستقوم بإنشاء مجموعة بيانات جديدة بسياسة بيانات "موصى بها" وستتعلم كيفية إضافة التحكم في الوصول.

ستوجهك هذه الجلسة أيضًا خلال خطوات إضافة ملف ترخيص مخصص إلى مثيل wis2box الخاص بك.

## التحضير

تأكد من أن لديك وصول SSH إلى الجهاز الافتراضي الخاص بك وأن مثيل wis2box الخاص بك يعمل.

تأكد من أنك متصل بوسيط MQTT الخاص بمثيل wis2box الخاص بك باستخدام MQTT Explorer. يمكنك استخدام بيانات الاعتماد العامة `everyone/everyone` للاتصال بالوسيط.

تأكد من فتح متصفح ويب مع تطبيق wis2box-webapp الخاص بمثيلك عن طريق الذهاب إلى `http://YOUR-HOST/wis2box-webapp`.

## إنشاء مجموعة بيانات جديدة بسياسة بيانات "موصى بها"

انتقل إلى صفحة "محرر مجموعة البيانات" في wis2box-webapp وقم بإنشاء مجموعة بيانات جديدة. اختر نوع البيانات = 'weather/surface-weather-observations/synop'.

<img alt="create-dataset-recommended" src="/../assets/img/create-dataset-template.png" width="800">

بالنسبة إلى "Centre ID"، استخدم نفس المعرف الذي استخدمته في الجلسات العملية السابقة.

انقر على 'CONTINUE TO FORM' للمتابعة.

استبدل "Local ID" الذي تم إنشاؤه تلقائيًا باسم وصفي لمجموعة البيانات، مثل 'recommended-data-with-access-control'، وقم بتحديث حقول "Title" و"Description":

<img alt="create-dataset-recommended" src="/../assets/img/create-dataset-recommended.png" width="800">

قم بتغيير سياسة بيانات WMO إلى "موصى بها" وستلاحظ أن النموذج أضاف حقل إدخال جديدًا لرابط يوفر معلومات الترخيص لمجموعة البيانات:

<img alt="create-dataset-license" src="/../assets/img/create-dataset-license.png" width="800">

لديك خيار تقديم رابط إلى ترخيص يصف شروط استخدام مجموعة البيانات. على سبيل المثال، استخدم
`https://creativecommons.org/licenses/by/4.0/` للإشارة إلى ترخيص Creative Commons Attribution 4.0 International (CC BY 4.0).

أو `WIS2BOX_URL/data/license.txt` للإشارة إلى ملف ترخيص مخصص استضفته على خادم الويب الخاص بك، حيث `WIS2BOX_URL` هو الرابط الذي قمت بتعريفه في ملف `wis2box.env`:

<img alt="create-dataset-license-url" src="/../assets/img/create-dataset-license-custom.png" width="800">

استمر في ملء الحقول المطلوبة لخصائص المكان ومعلومات الاتصال. انقر على 'Validate form' للتحقق من وجود أي أخطاء.

أخيرًا، قم بإرسال مجموعة البيانات باستخدام رمز المصادقة الذي أنشأته مسبقًا، وتحقق من أن مجموعة البيانات الجديدة قد تم إنشاؤها في wis2box-webapp.

تحقق من MQTT Explorer للتأكد من أنك تلقيت رسالة إشعار WIS2 تعلن عن سجل بيانات الاكتشاف الجديد على الموضوع `origin/a/wis2/<your-centre-id>/metadata`.

## مراجعة مجموعة البيانات الجديدة في wis2box-api

عرض قائمة مجموعات البيانات في wis2box-api عن طريق فتح الرابط `WIS2BOX_URL/oapi/collections/discovery-metadata/items` في متصفح الويب الخاص بك، مع استبدال `WIS2BOX_URL` بالرابط الخاص بمثيل wis2box الخاص بك.

افتح رابط مجموعة البيانات التي أنشأتها للتو وانتقل إلى قسم "links" في استجابة JSON:

<img alt="wis2box-api-recommended-dataset-links" src="/../assets/img/wis2box-api-recommended-dataset-links.png" width="600">

يجب أن ترى رابطًا لـ "License for this dataset" يشير إلى الرابط الذي قدمته في محرر مجموعة البيانات.

إذا كنت قد استخدمت `http://YOUR-HOST/data/license.txt` كرابط الترخيص، فلن يعمل الرابط حاليًا، لأننا لم نضف بعد ملف ترخيص إلى مثيل wis2box.

إذا سمح الوقت، يمكنك إضافة ملف ترخيص مخصص إلى مثيل wis2box الخاص بك في نهاية هذه الجلسة العملية. أولاً، سنواصل إضافة رمز وصول إلى مجموعة البيانات.

## إضافة رمز وصول إلى مجموعة البيانات

قم بتسجيل الدخول إلى حاوية wis2box-management،

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

من سطر الأوامر داخل الحاوية، يمكنك تأمين مجموعة بيانات باستخدام الأمر `wis2box auth add-token`، باستخدام العلامة `--metadata-id` لتحديد معرف البيانات الوصفية لمجموعة البيانات ورمز الوصول كوسيطة.

على سبيل المثال، لإضافة رمز الوصول `S3cr3tT0k3n` إلى مجموعة البيانات بمعرف البيانات الوصفية `urn:wmo:md:not-my-centre:core.surface-based-observations.synop`:

```bash
wis2box auth add-token --metadata-id urn:wmo:md:not-my-centre:reco.surface-based-observations.synop S3cr3tT0k3n
```

اخرج من حاوية wis2box-management:

```bash
exit
```

## نشر بعض البيانات في مجموعة البيانات

انسخ الملف `exercise-materials/access-control-exercises/aws-example.csv` إلى الدليل المحدد بواسطة `WIS2BOX_HOST_DATADIR` في ملف `wis2box.env`:

```bash
cp ~/exercise-materials/access-control-exercises/aws-example.csv ~/wis2box-data
```

ثم استخدم WinSCP أو محرر سطر الأوامر لتحرير الملف `aws-example.csv` وتحديث معرفات محطات WIGOS في بيانات الإدخال لتتطابق مع المحطات التي لديك في مثيل wis2box الخاص بك.

بعد ذلك، انتقل إلى محرر المحطات في wis2box-webapp. لكل محطة استخدمتها في `aws-example.csv`، قم بتحديث حقل "topic" ليتطابق مع "topic" لمجموعة البيانات التي أنشأتها في التمرين السابق.

سترتبط هذه المحطة الآن بموضوعين، أحدهما لمجموعة بيانات "core" والآخر لمجموعة بيانات "recommended":

<img alt="edit-stations-add-topics" src="/../assets/img/edit-stations-add-topics.png" width="600">

ستحتاج إلى استخدام الرمز الخاص بك لـ `collections/stations` لحفظ بيانات المحطة المحدثة.

بعد ذلك، قم بتسجيل الدخول إلى حاوية wis2box-management:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

من سطر أوامر wis2box، يمكننا إدخال ملف البيانات النموذجي `aws-example.csv` في مجموعة بيانات محددة على النحو التالي:

```bash
wis2box data ingest -p /data/wis2box/aws-example.csv --metadata-id urn:wmo:md:not-my-centre:reco.surface-based-observations.synop
```

تأكد من تقديم معرف البيانات الوصفية الصحيح لمجموعة البيانات الخاصة بك **وتحقق من أنك تتلقى إشعارات بيانات WIS2 في MQTT Explorer**، على الموضوع `origin/a/wis2/<your-centre-id>/data/recommended/surface-based-observations/synop`.

تحقق من الرابط القانوني في رسالة إشعار WIS2 وقم بنسخه/لصقه في المتصفح لمحاولة تنزيل البيانات.

يجب أن ترى رسالة *401 Authorization Required*.

## إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات

لإثبات أن رمز الوصول مطلوب للوصول إلى مجموعة البيانات، سنعيد إنتاج الخطأ الذي رأيته في المتصفح باستخدام وظيفة سطر الأوامر `wget`.

من سطر الأوامر في الجهاز الافتراضي الخاص بك، استخدم أمر `wget` مع الرابط القانوني الذي نسخته من رسالة إشعار WIS2.

```bash
wget <canonical-link>
```

يجب أن ترى أن طلب HTTP يعيد *401 Unauthorized* ولم يتم تنزيل البيانات.

الآن أضف رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات.

```bash
wget --header="Authorization: Bearer S3cr3tT0k3n" <canonical-link>
```

الآن يجب تنزيل البيانات بنجاح.

## إضافة ملف ترخيص مخصص إلى مثيل wis2box الخاص بك

هذه الخطوة مطلوبة فقط إذا كنت ترغب في تقديم ترخيص مخصص مستضاف بواسطة مثيل wis2box الخاص بك، بدلاً من استخدام رابط ترخيص خارجي.

قم بإنشاء ملف نصي على جهازك المحلي باستخدام محرر النصوص المفضل لديك وأضف بعض معلومات الترخيص إلى الملف، مثل:

*هذا ملف ترخيص مخصص لمجموعة البيانات الموصى بها مع التحكم في الوصول.  
يمكنك استخدام هذه البيانات بحرية، ولكن يرجى الإشارة إلى مزود البيانات.*

لتحميل ملف تم إنشاؤه محليًا يسمى `license.txt`، استخدم وحدة تحكم MinIO المتوفرة على المنفذ 9001 من مثيل wis2box، عن طريق الذهاب إلى متصفح الويب وزيارة `http://YOUR-HOST:9001`

بيانات الاعتماد للوصول إلى وحدة تحكم MinIO في ملف `wis2box.env` يتم تعريفها بواسطة متغيرات البيئة `WIS2BOX_STORAGE_USERNAME` و`WIS2BOX_STORAGE_PASSWORD`.

يمكنك العثور عليها في ملف `wis2box.env` على النحو التالي:

```bash
cat wis2box.env | grep WIS2BOX_STORAGE_USERNAME
cat wis2box.env | grep WIS2BOX_STORAGE_PASSWORD
```

بمجرد تسجيل الدخول إلى وحدة تحكم MinIO، قم بتحميل ملف الترخيص إلى المسار الأساسي لدلو **wis2box-public** باستخدام زر "Upload":

<img alt="minio-upload-license" src="/../assets/img/minio-upload-license.png" width="800">

بعد تحميل ملف الترخيص، تحقق مما إذا كان الملف قابلاً للوصول عن طريق زيارة `WIS2BOX_URL/data/license.txt` في متصفح الويب الخاص بك، مع استبدال `WIS2BOX_URL` بالرابط الخاص بمثيل wis2box الخاص بك.

!!! note

    يقوم الوكيل العكسي في wis2box بإعادة توجيه جميع الملفات المخزنة في دلو "wis2box-public" تحت المسار `WIS2BOX_URL/data/`

يجب أن يعمل الرابط الخاص بـ "License for this dataset" المضمن في بيانات الاكتشاف الوصفية لمجموعة البيانات الموصى بها الآن كما هو متوقع.

## الخاتمة

!!! success "تهانينا!"
    في هذه الجلسة العملية، تعلمت كيفية:

    - إنشاء مجموعة بيانات جديدة بسياسة بيانات "موصى بها"
    - إضافة رمز وصول إلى مجموعة البيانات
    - التحقق من أن مجموعة البيانات لا يمكن الوصول إليها بدون رمز الوصول
    - إضافة رمز الوصول إلى رؤوس HTTP للوصول إلى مجموعة البيانات
    - إضافة ملف ترخيص مخصص إلى مثيل wis2box الخاص بك