---
title: Настройка наборов данных в wis2box
---

# Настройка наборов данных в wis2box

!!! abstract "Результаты обучения"
    К концу этой практической сессии вы сможете:

    - Создавать новые наборы данных, используя шаблон по умолчанию и ваш собственный шаблон
    - создавать метаданные для обнаружения вашего набора данных
    - настраивать сопоставления данных для вашего набора данных
    - публиковать уведомление WIS2 с записью WCMP2
    - обновлять и повторно публиковать ваш набор данных

## Введение

wis2box использует наборы данных, которые связаны с метаданными для обнаружения и сопоставлениями данных.

Метаданные для обнаружения используются для создания записи WCMP2 (WMO Core Metadata Profile 2), которая распространяется через уведомление WIS2, опубликованное на вашем wis2box-broker.

Сопоставления данных используются для связывания плагина данных с вашими входными данными, что позволяет преобразовывать данные перед их публикацией через уведомление WIS2.

В этой сессии вы научитесь создавать новые наборы данных, используя шаблон по умолчанию и ваш собственный шаблон, создавать метаданные для обнаружения и настраивать сопоставления данных. Вы проверите свои наборы данных в wis2box-api и изучите уведомление WIS2 для ваших метаданных.

## Подготовка

Подключитесь к вашему брокеру, используя MQTT Explorer.

Вместо использования ваших внутренних учетных данных брокера используйте публичные учетные данные `everyone/everyone`:

<img alt="MQTT Explorer: Подключение к брокеру" src="/../assets/img/mqtt-explorer-wis2box-broker-everyone-everyone.png" width="800">

!!! Note

    Вам никогда не нужно делиться учетными данными вашего внутреннего брокера с внешними пользователями. Пользователь 'everyone' является публичным пользователем, который позволяет делиться уведомлениями WIS2.

    Учетные данные `everyone/everyone` имеют доступ только для чтения к теме 'origin/a/wis2/#'. Это тема, где публикуются уведомления WIS2. Global Broker может подписываться на эти уведомления, используя публичные учетные данные.
    
    Пользователь 'everyone' не сможет видеть внутренние темы или публиковать сообщения.
    
Откройте браузер и перейдите на страницу `http://YOUR-HOST/wis2box-webapp`. Убедитесь, что вы вошли в систему и можете получить доступ к странице 'dataset editor'.

См. раздел [Инициализация wis2box](./initializing-wis2box.md), если вам нужно вспомнить, как подключиться к брокеру или получить доступ к wis2box-webapp.

## Создание токена авторизации для processes/wis2box

Вам потребуется токен авторизации для конечной точки 'processes/wis2box', чтобы опубликовать ваш набор данных.

Чтобы создать токен авторизации, подключитесь к вашей обучающей виртуальной машине через SSH и выполните следующие команды для входа в контейнер wis2box-management:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

Затем выполните следующую команду, чтобы создать случайно сгенерированный токен авторизации для конечной точки 'processes/wis2box':

```bash
wis2box auth add-token --path processes/wis2box
```

Вы также можете создать токен с определенным значением, передав токен в качестве аргумента команды:

```bash
wis2box auth add-token --path processes/wis2box MyS3cretToken
```

Обязательно скопируйте значение токена и сохраните его на вашем локальном компьютере, так как он понадобится вам позже.

После того как вы получите токен, выйдите из контейнера wis2box-management:

```bash
exit
```

## Создание новых наборов данных в wis2box-webapp

Перейдите на страницу 'dataset editor' в wis2box-webapp вашей инстанции wis2box, открыв `http://YOUR-HOST/wis2box-webapp` и выбрав 'dataset editor' в меню слева.

На странице 'dataset editor', в разделе 'Datasets', нажмите "Create New ...":

<img alt="Создание нового набора данных" src="/../assets/img/wis2box-create-new-dataset.png" width="800">

Появится всплывающее окно, в котором вам нужно указать:

- **Centre ID**: это акроним агентства (в нижнем регистре и без пробелов), как указано членом ВМО, который идентифицирует центр данных, ответственный за публикацию данных.
- **Template**: Шаблон, соответствующий типу данных, для которых вы создаете метаданные. Вы можете выбрать предопределенный шаблон или выбрать 'other'. Если выбран 'other', это означает, что вы хотите определить пользовательский шаблон, и поэтому дополнительные поля должны быть заполнены вручную.

<img alt="Всплывающее окно создания нового набора данных" src="/../assets/img/wis2box-create-new-dataset-pop-up.png" width="600">

!!! Note "Centre ID"

    Ваш centre-id должен начинаться с TLD вашей страны, за которым следует дефис (`-`) и сокращенное название вашей организации (например, `fr-meteofrance`). Centre-id должен быть в нижнем регистре и содержать только буквенно-цифровые символы. Выпадающий список показывает все зарегистрированные centre-id в WIS2, а также любые centre-id, которые вы уже создали в wis2box. Пожалуйста, выберите centre-id, соответствующий вашей организации.

!!! Note "Template"

    Поле *Template* позволяет выбрать из списка шаблонов, доступных в редакторе наборов данных wis2box-webapp. Шаблон предварительно заполняет форму предложенными значениями по умолчанию, подходящими для типа данных. Это включает предложенные заголовок и ключевые слова для метаданных, а также предварительно настроенные плагины данных. Тема автоматически устанавливается на тему по умолчанию, связанную с выбранным шаблоном.

    Для целей обучения мы будем работать с двумя вариантами при создании новых наборов данных:
    
    1. Предопределенный шаблон *weather/surface-based-observations/synop*, который включает плагины данных для преобразования данных в формат BUFR перед публикацией;
    2. Шаблон *other*, который позволяет вам определить собственный пользовательский шаблон, вручную заполнив необходимые поля.

    Если вы хотите публиковать оповещения CAP, используя wis2box, используйте шаблон *weather/advisories-warnings*. Этот шаблон включает плагин данных, который проверяет, что входные данные являются допустимым оповещением CAP перед публикацией. Чтобы создавать оповещения CAP и публиковать их через wis2box, вы можете использовать [WMO CAP Composer](https://github.com/World-Meteorological-Organization/cap-composer) или перенаправить XML CAP из вашей системы в корзину wis2box-incoming.

Теперь давайте создадим новый набор данных, используя предопределенный шаблон.

## Создание нового набора данных с использованием предопределенного шаблона

Для **Template** выберите **weather/surface-based-observations/synop**:

<img alt="Форма создания нового набора данных: начальная информация" src="/../assets/img/wis2box-create-new-dataset-form-initial.png" width="450">

Нажмите *continue to form*, чтобы продолжить. Теперь вы увидите **Dataset Editor Form**.

Поскольку вы выбрали шаблон **weather/surface-based-observations/synop**, форма будет предварительно заполнена начальными значениями, связанными с этим типом данных.

### Создание метаданных для обнаружения

Форма Dataset Editor Form позволяет вам указать метаданные для обнаружения вашего набора данных, которые контейнер wis2box-management будет использовать для публикации записи WCMP2.

Поскольку вы выбрали шаблон 'weather/surface-based-observations/synop', форма будет предварительно заполнена значениями по умолчанию.

Пожалуйста, замените автоматически сгенерированный 'Local ID' на описательное имя для вашего набора данных, например, 'synop-dataset-wis2training':

<img alt="Редактор метаданных: заголовок, описание, ключевые слова" src="/../assets/img/wis2box-metadata-editor-part1.png" width="800">

Просмотрите заголовок и ключевые слова, обновите их при необходимости и укажите описание для вашего набора данных.

Обратите внимание, что есть опции для изменения 'WMO Data Policy' с 'core' на 'recommended' или для изменения идентификатора метаданных по умолчанию. Пожалуйста, оставьте политику данных как 'core' и используйте идентификатор метаданных по умолчанию.

Далее, просмотрите раздел, определяющий ваши 'Temporal Properties' и 'Spatial Properties'. Вы можете настроить ограничивающую рамку, обновив поля 'North Latitude', 'South Latitude', 'East Longitude' и 'West Longitude':

<img alt="Редактор метаданных: временные свойства, пространственные свойства" src="/../assets/img/wis2box-metadata-editor-part2.png" width="800">

Далее, заполните раздел, определяющий 'Contact Information of the Data Provider':

<img alt="Редактор метаданных: контактная информация" src="/../assets/img/wis2box-metadata-editor-part3.png" width="800">

Наконец, заполните раздел, определяющий 'Data Quality Information':

После того как вы заполните все разделы, нажмите 'VALIDATE FORM' и проверьте форму на наличие ошибок:

<img alt="Редактор метаданных: проверка" src="/../assets/img/wis2box-metadata-validation-error.png" width="800">

Если есть ошибки, исправьте их и снова нажмите 'VALIDATE FORM'.

Убедитесь, что ошибок нет, и вы получили всплывающее уведомление о том, что ваша форма прошла проверку:

<img alt="Редактор метаданных: успешная проверка" src="/../assets/img/wis2box-metadata-validation-success.png" width="800">

Далее, перед отправкой вашего набора данных, просмотрите сопоставления данных для вашего набора данных.

### Настройка сопоставлений данных

Поскольку вы использовали шаблон для создания вашего набора данных, сопоставления данных были предварительно заполнены плагинами по умолчанию для шаблона 'weather/surface-based-observations/synop'. Плагины данных используются в wis2box для преобразования данных перед их публикацией через уведомление WIS2.

<img alt="Сопоставления данных: обновление плагина" src="/../assets/img/wis2box-data-mappings.png" width="800">

Обратите внимание, что вы можете нажать на кнопку "update", чтобы изменить настройки плагина, такие как расширение файла и шаблон имени файла. Пока можно оставить настройки по умолчанию. Это будет подробно объяснено позже при создании пользовательского набора данных.

### Публикация вашего набора данных

Наконец, вы можете нажать 'submit', чтобы опубликовать ваш набор данных.

Вам потребуется предоставить токен авторизации для 'processes/wis2box', который вы создали ранее. Если вы этого еще не сделали, вы можете создать новый токен, следуя инструкциям в разделе подготовки.

Убедитесь, что после отправки вашего набора данных вы получили следующее сообщение, указывающее на успешную публикацию набора данных:

<img alt="Submit Dataset Success" src="/../assets/img/wis2box-submit-dataset-success.png" width="400">

После нажатия 'OK' вы будете перенаправлены на главную страницу редактора наборов данных. Теперь, если вы нажмете на вкладку 'Dataset', вы должны увидеть ваш новый набор данных в списке:

<img alt="Dataset Editor: new dataset" src="/../assets/img/wis2box-dataset-editor-new-dataset.png" width="800">

### Проверка WIS2-уведомления для метаданных обнаружения

Перейдите в MQTT Explorer. Если вы подключены к брокеру, вы должны увидеть новое WIS2-уведомление, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`:

<img alt="MQTT Explorer: WIS2 notification" src="/../assets/img/mqtt-explorer-wis2-notification-metadata.png" width="800">

Изучите содержимое опубликованного вами WIS2-уведомления. Вы должны увидеть JSON-структуру, соответствующую формату WIS Notification Message (WNM).

!!! question

    В какой теме опубликовано WIS2-уведомление?

??? success "Нажмите, чтобы увидеть ответ"

    WIS2-уведомление опубликовано в теме `origin/a/wis2/<your-centre-id>/metadata`.

!!! question
    
    Попробуйте найти заголовок, описание и ключевые слова, которые вы указали в метаданных обнаружения, в WIS2-уведомлении. Можете ли вы их найти?

??? success "Нажмите, чтобы увидеть ответ"

    **Заголовок, описание и ключевые слова, которые вы указали в метаданных обнаружения, отсутствуют в содержимом WIS2-уведомления!**

    Вместо этого попробуйте найти каноническую ссылку в разделе "links" WIS2-уведомления:

    <img alt="WIS2 notification for metadata, links sections" src="/../assets/img/wis2-notification-metadata-links.png" width="800">

    **WIS2-уведомление содержит каноническую ссылку на опубликованную запись WCMP2.**

    Скопируйте и вставьте эту каноническую ссылку в ваш браузер, чтобы получить доступ к записи WCMP2. В зависимости от настроек вашего браузера вам может быть предложено скачать файл или он может быть отображен непосредственно в браузере.

    Вы найдете заголовок, описание и ключевые слова, которые вы указали, внутри записи WCMP2.

wis2box предоставляет только ограниченное количество предопределенных шаблонов. Эти шаблоны разработаны для общих типов наборов данных, но они могут не всегда соответствовать специализированным данным. Когда предопределенные шаблоны не подходят, можно создать пользовательский шаблон. Это позволяет пользователям определять необходимые поля метаданных в соответствии с их набором данных.

В следующем разделе мы создадим новый набор данных и покажем, как настроить его с использованием пользовательского шаблона.

## Создание нового набора данных с настройкой пользовательского шаблона

Для **Template** выберите **other**:

<img alt="Create New Dataset Form: Initial information" src="/../assets/img/wis2box-create-new-dataset-form-initial-other.png" width="450">

Нажмите *continue to form*, чтобы продолжить. Теперь вы увидите **Dataset Editor Form**.

Поскольку был выбран шаблон *other*, следующим шагом будет нажатие *Continue* для перехода к форме. Теперь вы увидите форму редактора набора данных. В этой форме ключевые поля, такие как Title, Description, Sub-discipline topics и Keywords, должны быть заполнены или проверены пользователем. Опция Experimental (free text topic) контролирует, как определяются Sub-discipline topics: если эта опция выбрана, Sub-discipline topics можно вводить в виде свободного текста, позволяя пользователю задавать пользовательскую тему. Если опция не выбрана, Sub-discipline topics представляется в виде выпадающего списка, и необходимо выбрать один из предопределенных вариантов.

### Создание пользовательских метаданных обнаружения

На этом этапе вам нужно будет заполнить обязательные поля в форме редактора набора данных, включая Title, Description, Local ID, Sub-discipline topics и Keywords.

Для целей этого обучения мы заполним эти поля, используя пользовательский шаблон набора данных Global Ensemble Prediction System (GEPS) в качестве примера. Этот пример служит только для справки — в реальных операциях WIS2 пользователи должны настраивать поля метаданных в соответствии с требованиями их собственных наборов данных.

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/wis2box-metadata-editor-part1-other.png" width="800">

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/wis2box-metadata-editor-part1-other-2.png" width="800">

Последующие шаги такие же, как при создании набора данных с предопределенным шаблоном synop. Для получения подробных инструкций обратитесь к разделу *Creating discovery metadata* в разделе *Create a new dataset by using a predefined template*.

### Настройка пользовательских сопоставлений данных

Когда используется пользовательский шаблон, предопределенные сопоставления данных не предоставляются. В результате редактор сопоставлений набора данных будет пуст, и пользователи должны настроить сопоставления в соответствии со своими требованиями.

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other1.png" width="800">

В этом обучении мы настроим набор данных GEPS и используем универсальный плагин для данных без преобразования в качестве примера. Этот плагин предназначен для публикации данных без применения каких-либо преобразований. Поскольку данные GEPS предоставляются в формате GRIB2, расширение файла должно быть установлено на .grib2; в противном случае данные не могут быть успешно опубликованы.

Особое внимание следует уделить полю Regex, так как оно напрямую влияет на обработку данных. Если регулярное выражение не соответствует шаблону именования файлов данных, произойдут ошибки публикации. Чтобы этого избежать, либо обновите регулярное выражение в соответствии с вашим соглашением об именовании набора данных, либо оставьте регулярное выражение по умолчанию и убедитесь, что ваши файлы данных переименованы соответствующим образом.

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other2.png" width="800">

В реальных операциях WIS2 пользователи могут выбирать разные плагины в зависимости от своих требований; здесь мы используем универсальный плагин для данных без преобразования только в качестве примера.

Если вы хотите публиковать другие типы и форматы данных, вы можете нажать на кнопку "update", чтобы изменить такие настройки, как расширение файла и шаблон имени файла.

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other3.png" width="800">

### Публикация вашего пользовательского набора данных

Процесс публикации такой же, как описано в разделе *Submitting your dataset* в разделе *Create a new dataset by using a predefined template*. Пожалуйста, обратитесь к этому разделу для получения подробных инструкций.

После успешной публикации ваш новый набор данных появится во вкладке Dataset:

<img alt="Dataset Editor: new dataset" src="/../assets/img/wis2box-dataset-editor-new-dataset-other.png" width="800">

### Проверка WIS2-уведомления для метаданных обнаружения

Перейдите в MQTT Explorer. Если вы подключены к брокеру, вы должны увидеть новое WIS2-уведомление, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`:

<img alt="MQTT Explorer: WIS2 notification" src="/../assets/img/mqtt-explorer-wis2-notification-metadata-other.png" width="800">

!!! question
    
    Каков идентификатор метаданных пользовательского набора данных GEPS, который вы создали?

??? success "Нажмите, чтобы увидеть ответ"

    Открыв интерфейс wis2box, вы можете просмотреть пользовательский набор данных GEPS. Идентификатор метаданных:

    *urn:wmo:md:nl-knmi-test:customized-geps-dataset-wis2-training*

!!! question

    Если мы изменим набор данных, будет ли отправлено новое уведомление о данных? Какие изменения можно ожидать?

??? success "Нажмите, чтобы увидеть ответ"

    Да. Будет отправлено новое уведомление о данных. В сообщении значение "rel": "canonical" в элементе "links" изменится на "rel": "update", указывая на то, что набор данных был изменен.

!!! question
    
    Если мы удалим набор данных, будет ли отправлено новое уведомление о данных? Какие изменения можно ожидать?

??? success "Нажмите, чтобы увидеть ответ"

    Да. Будет отправлено новое уведомление о данных. В сообщении значение "rel": "canonical" в элементе "links" изменится на "rel": "deletion", указывая на то, что набор данных был удален.

## Заключение

!!! success "Поздравляем!"
    В ходе этой практической сессии вы научились:

    - Создавать новые наборы данных, используя шаблон по умолчанию и ваш пользовательский шаблон
    - Определять метаданные обнаружения
    - Проверять сопоставления данных
    - Публиковать метаданные обнаружения
    - Проверять WIS2-уведомления для ваших метаданных обнаружения