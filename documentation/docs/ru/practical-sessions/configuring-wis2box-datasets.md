---
title: Настройка наборов данных в wis2box
---

# Настройка наборов данных в wis2box

!!! abstract "Результаты обучения"
    По завершении этого практического занятия вы сможете:

    - создать новый набор данных
    - создать метаданные обнаружения для набора данных
    - настроить сопоставления данных для набора данных
    - опубликовать уведомление WIS2 с записью WCMP2
    - обновить и повторно опубликовать ваш набор данных

## Введение

wis2box использует наборы данных, связанные с метаданными обнаружения и сопоставлениями данных.

Метаданные обнаружения используются для создания записи WCMP2 (WMO Core Metadata Profile 2), которая распространяется с помощью уведомления WIS2, публикуемого на вашем wis2box-broker.

Сопоставления данных используются для связывания плагина данных с вашими входными данными, позволяя преобразовывать данные перед их публикацией с использованием уведомления WIS2.

В этом занятии вы пройдете через процесс создания нового набора данных, создания метаданных обнаружения и настройки сопоставлений данных. Вы проверите ваш набор данных в wis2box-api и просмотрите уведомление WIS2 для ваших метаданных обнаружения.

## Подготовка

Подключитесь к вашему брокеру используя MQTT Explorer.

Вместо использования учетных данных вашего внутреннего брокера, используйте публичные учетные данные `everyone/everyone`:

<img alt="MQTT Explorer: Connect to broker" src="../../assets/img/mqtt-explorer-wis2box-broker-everyone-everyone.png" width="800">

!!! Note

    Вам никогда не нужно делиться учетными данными вашего внутреннего брокера с внешними пользователями. Пользователь 'everyone' - это публичный пользователь для обеспечения обмена уведомлениями WIS2.

    Учетные данные `everyone/everyone` имеют доступ только для чтения к теме 'origin/a/wis2/#'. Это тема, где публикуются уведомления WIS2. Global Broker может подписываться с этими публичными учетными данными для получения уведомлений.
    
    Пользователь 'everyone' не будет видеть внутренние темы или иметь возможность публиковать сообщения.

Откройте браузер и перейдите на страницу `http://YOUR-HOST/wis2box-webapp`. Убедитесь, что вы вошли в систему и можете получить доступ к странице 'dataset editor'.

Обратитесь к разделу [Инициализация wis2box](/practical-sessions/initializing-wis2box), если вам нужно вспомнить, как подключиться к брокеру или получить доступ к wis2box-webapp.

## Создание токена авторизации для processes/wis2box

Вам понадобится токен авторизации для конечной точки 'processes/wis2box', чтобы опубликовать ваш набор данных.

Для создания токена авторизации подключитесь к вашей учебной VM через SSH и используйте следующие команды для входа в контейнер wis2box-management:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

Затем выполните следующую команду для создания случайно сгенерированного токена авторизации для конечной точки 'processes/wis2box':

```bash
wis2box auth add-token --path processes/wis2box
```

Вы также можете создать токен с определенным значением, указав токен в качестве аргумента команды:

```bash
wis2box auth add-token --path processes/wis2box MyS3cretToken
```

Обязательно скопируйте значение токена и сохраните его на вашем локальном компьютере, так как оно понадобится вам позже.

После получения токена вы можете выйти из контейнера wis2box-management:

```bash
exit
```

## Создание нового набора данных в wis2box-webapp

Перейдите на страницу 'dataset editor' в wis2box-webapp вашего экземпляра wis2box, перейдя по адресу `http://YOUR-HOST/wis2box-webapp` и выбрав 'dataset editor' в меню слева.

На странице 'dataset editor', во вкладке 'Datasets', нажмите "Create New ...":

<img alt="Create New Dataset" src="../../assets/img/wis2box-create-new-dataset.png" width="800">

Появится всплывающее окно, где вам нужно будет указать:

- **Centre ID**: это аббревиатура агентства (в нижнем регистре и без пробелов), указанная членом ВМО, которая идентифицирует центр данных, ответственный за публикацию данных.
- **Data Type**: Тип данных, для которых вы создаете метаданные. Вы можете выбрать между использованием предопределенного шаблона или выбором 'other'. Если выбрано 'other', больше полей придется заполнять вручную.

!!! Note "Centre ID"

    Ваш centre-id должен начинаться с TLD вашей страны, за которым следует дефис (`-`) и сокращенное название вашей организации (например, `fr-meteofrance`). Centre-id должен быть в нижнем регистре и использовать только буквенно-цифровые символы. В выпадающем списке показаны все текущие зарегистрированные centre-id в WIS2, а также любые centre-id, которые вы уже создали в wis2box.

!!! Note "Data Type Templates"

    Поле *Data Type* позволяет выбрать из списка шаблонов, доступных в редакторе наборов данных wis2box-webapp. Шаблон предварительно заполнит форму предлагаемыми значениями по умолчанию, подходящими для типа данных. Это включает предлагаемые заголовок и ключевые слова для метаданных и предварительно настроенные плагины данных. Тема будет фиксированной для типа данных по умолчанию.

    Для целей обучения мы будем использовать тип данных *weather/surface-based-observations/synop*, который включает плагины данных, обеспечивающие преобразование данных в формат BUFR перед публикацией.

    Если вы хотите публиковать оповещения CAP с помощью wis2box, используйте шаблон *weather/advisories-warnings*. Этот шаблон включает плагин данных, который проверяет, являются ли входные данные действительным оповещением CAP перед публикацией. Для создания оповещений CAP и их публикации через wis2box вы можете использовать [CAP Composer](https://github.com/wmo-raf/cap-composer).

Пожалуйста, выберите centre-id, подходящий для вашей организации.

Для **Data Type** выберите **weather/surface-based-observations/synop**:

<img alt="Create New Dataset Form: Initial information" src="../../assets/img/wis2box-create-new-dataset-form-initial.png" width="450">

Нажмите *continue to form* для продолжения, вам будет представлена **Форма редактора наборов данных**.

Поскольку вы выбрали тип данных **weather/surface-based-observations/synop**, форма будет предварительно заполнена некоторыми начальными значениями, связанными с этим типом данных.

## Создание метаданных обнаружения

Форма редактора наборов данных позволяет предоставить метаданные обнаружения для вашего набора данных, которые контейнер wis2box-management будет использовать для публикации записи WCMP2.

Поскольку вы выбрали тип данных 'weather/surface-based-observations/synop', форма будет предварительно заполнена некоторыми значениями по умолчанию.

Пожалуйста, замените автоматически сгенерированный 'Local ID' на описательное имя для вашего набора данных, например, 'synop-dataset-wis2training':

<img alt="Metadata Editor: title, description, keywords" src="../../assets/img/wis2box-metadata-editor-part1.png" width="800">

Просмотрите заголовок и ключевые слова, при необходимости обновите их и предоставьте описание для вашего набора данных.

Обратите внимание, что есть возможности изменить 'WMO Data Policy' с 'core' на 'recommended' или изменить ваш идентификатор метаданных по умолчанию, пожалуйста, оставьте data-policy как 'core' и используйте идентификатор метаданных по умолчанию.

Далее просмотрите раздел, определяющий ваши 'Temporal Properties' и 'Spatial Properties'. Вы можете настроить ограничивающий прямоугольник, обновив поля 'North Latitude', 'South Latitude', 'East Longitude' и 'West Longitude':

<img alt="Metadata Editor: temporal properties, spatial properties" src="../../assets/img/wis2box-metadata-editor-part2.png" width="800">

Далее заполните раздел, определяющий 'Contact Information of the Data Provider':

<img alt="Metadata Editor: contact information" src="../../assets/img/wis2box-metadata-editor-part3.png" width="800">

Наконец, заполните раздел, определяющий 'Data Quality Information':

После заполнения всех разделов нажмите 'VALIDATE FORM' и проверьте форму на наличие ошибок:

<img alt="Metadata Editor: validation" src="../../assets/img/wis2box-metadata-validation-error.png" width="800">

Если есть какие-либо ошибки, исправьте их и снова нажмите 'VALIDATE FORM'.

Убедитесь, что у вас нет ошибок и что вы получили всплывающее уведомление о том, что ваша форма была проверена:

<img alt="Metadata Editor: validation success" src="../../assets/img/wis2box-metadata-validation-success.png" width="800">

Далее, перед отправкой вашего набора данных, просмотрите сопоставления данных для вашего набора данных.

## Настройка сопоставлений данных

Поскольку вы использовали шаблон для создания вашего набора данных, сопоставления данных были предварительно заполнены плагинами по умолчанию для типа данных 'weather/surface-based-observations/synop'. Плагины данных используются в wis2box для преобразования данных перед их публикацией с использованием уведомления WIS2.

<img alt="Data Mappings: update plugin" src="../../assets/img/wis2box-data-mappings.png" width="800">

Обратите внимание, что вы можете нажать на кнопку "update" для изменения настроек плагина, таких как расширение файла и шаблон файла, пока можно оставить настройки по умолчанию. В следующем занятии вы узнаете больше о BUFR и преобразовании данных в формат BUFR.

## Отправка вашего набора данных

Наконец, вы можете нажать 'submit' для публикации вашего набора данных.

Вам потребуется предоставить токен авторизации для 'processes/wis2box', который вы создали ранее. Если вы этого не сделали, вы можете создать новый токен, следуя инструкциям в разделе подготовки.

Проверьте, что после отправки набора данных вы получили следующее сообщение, указывающее на успешную отправку набора данных:

<img alt="Submit Dataset Success" src="../../assets/img/wis2box-submit-dataset-success.png" width="400">

После нажатия 'OK' вы будете перенаправлены на главную страницу редактора наборов данных. Теперь, если вы нажмете на вкладку 'Dataset', вы должны увидеть ваш новый набор данных в списке:

<img alt="Dataset Editor: new dataset" src="../../assets/img/wis2box-dataset-editor-new-dataset.png" width="800">

## Просмотр уведомления WIS2 для ваших метаданных обнаружения

Перейдите в MQTT Explorer, если вы были подключены к брокеру, вы должны увидеть новое уведомление WIS2, опубликованное по теме `origin/a/wis2/<your-centre-id>/metadata`:

<img alt="MQTT Explorer: WIS2 notification" src="../../assets/img/mqtt-explorer-wis2-notification-metadata.png" width="800">

Проверьте содержимое опубликованного вами уведомления WIS2. Вы должны увидеть JSON со структурой, соответствующей формату WIS Notification Message (WNM).

!!! question

    По какой теме публикуется уведомление WIS2?

??? success "Нажмите, чтобы увидеть ответ"

    Уведомление WIS2 публикуется по теме `origin/a/wis2/<your-centre-id>/metadata`.

!!! question
    
    Попробуйте найти заголовок, описание и ключевые слова, которые вы указали в метаданных обнаружения в уведомлении WIS2. Можете ли вы их найти?

??? success "Нажмите, чтоб