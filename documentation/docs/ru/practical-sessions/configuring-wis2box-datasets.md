---
title: Настройка наборов данных в wis2box
---

# Настройка наборов данных в wis2box

!!! abstract "Результаты обучения"
    По завершении этого практического занятия вы сможете:

    - использовать редактор наборов данных в wis2box-webapp;
    - создавать новые наборы данных, используя Template=*weather/surface-based-observations/synop* и Template=*other*;
    - определять метаданные для обнаружения;
    - проверять соответствие данных и их преобразования;
    - публиковать уведомления WIS2 для ваших метаданных;
    - проверять уведомления WIS2 для ваших метаданных.

## Введение

wis2box использует наборы данных, которые связаны с метаданными для обнаружения и соответствием данных.

Метаданные для обнаружения используются для создания записи WCMP2 (WMO Core Metadata Profile 2), которая распространяется через уведомление WIS2, публикуемое в вашем wis2box-broker.

Соответствие данных используется для связывания плагина данных с вашими входными данными, что позволяет преобразовывать данные перед их публикацией через уведомление WIS2.

В этом занятии вы научитесь создавать новые наборы данных, используя шаблон по умолчанию и ваш собственный шаблон, создавать метаданные для обнаружения и настраивать соответствие данных. Вы проверите свои наборы данных в wis2box-api и изучите уведомления WIS2 для ваших метаданных.

## Подготовка

Подключитесь к вашему брокеру, используя MQTT Explorer.

Вместо использования ваших внутренних учетных данных брокера используйте публичные учетные данные `everyone/everyone`:

<img alt="MQTT Explorer: Подключение к брокеру" src="/../assets/img/mqtt-explorer-wis2box-broker-everyone-everyone.png" width="800">

!!! Note

    Вам никогда не нужно делиться учетными данными вашего внутреннего брокера с внешними пользователями. Пользователь 'everyone' — это публичный пользователь, который позволяет делиться уведомлениями WIS2.

    Учетные данные `everyone/everyone` предоставляют доступ только для чтения к теме 'origin/a/wis2/#'. Это тема, где публикуются уведомления WIS2. Global Broker может подписываться на эти уведомления, используя публичные учетные данные.
    
    Пользователь 'everyone' не сможет видеть внутренние темы или публиковать сообщения.
    
Откройте браузер и перейдите на страницу `http://YOUR-HOST/wis2box-webapp`. Убедитесь, что вы вошли в систему и можете получить доступ к странице 'dataset editor'.

См. раздел [Инициализация wis2box](./initializing-wis2box.md), если вам нужно вспомнить, как подключиться к брокеру или получить доступ к wis2box-webapp.

## Создание токена авторизации для processes/wis2box

Вам потребуется токен авторизации для конечной точки 'processes/wis2box', чтобы опубликовать ваш набор данных.

Чтобы создать токен авторизации, подключитесь к вашей обучающей виртуальной машине через SSH и выполните следующие команды для входа в контейнер wis2box-management:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

Затем выполните следующую команду, чтобы создать случайно сгенерированный токен авторизации для конечной точки 'processes/wis2box':

```bash
wis2box auth add-token --path processes/wis2box
```

Вы также можете создать токен с определенным значением, передав токен в качестве аргумента команды:

```bash
wis2box auth add-token --path processes/wis2box MyS3cretToken
```

Убедитесь, что вы скопировали значение токена и сохранили его на вашем локальном компьютере, так как он понадобится вам позже.

После получения токена вы можете выйти из контейнера wis2box-management:

```bash
exit
```

## Использование редактора наборов данных

Перейдите на страницу 'dataset editor' в wis2box-webapp вашей установки wis2box, открыв `http://YOUR-HOST/wis2box-webapp` и выбрав 'dataset editor' в меню слева.

На странице 'dataset editor', во вкладке 'Datasets', нажмите "Create New ...":

<img alt="Создание нового набора данных" src="/../assets/img/wis2box-create-new-dataset.png" width="800">

Появится всплывающее окно, в котором нужно указать:

- **Centre ID**: это акроним агентства (в нижнем регистре и без пробелов), как указано членом ВМО, который идентифицирует центр данных, ответственный за публикацию данных.
- **Template**: тип данных, для которых вы создаете метаданные. Вы можете выбрать предопределенный шаблон или выбрать *other*.

<img alt="Всплывающее окно создания нового набора данных" src="/../assets/img/wis2box-create-new-dataset-pop-up.png" width="600">

!!! Note "Centre ID"

    Ваш centre-id должен начинаться с TLD вашей страны, за которым следует дефис (`-`) и сокращенное название вашей организации (например, `fr-meteofrance`). Centre-id должен быть в нижнем регистре и содержать только буквенно-цифровые символы. Выпадающий список показывает все зарегистрированные centre-id в WIS2, а также любые centre-id, которые вы уже создали в wis2box. Пожалуйста, выберите centre-id, соответствующий вашей организации.

!!! Note "Template"

    Поле *Template* позволяет выбрать из списка шаблонов, доступных в редакторе наборов данных wis2box-webapp. Шаблон предварительно заполняет форму предложенными значениями по умолчанию, подходящими для типа данных. Это включает предложенные заголовки и ключевые слова для метаданных, а также предварительно настроенные плагины данных.
    
    Тема автоматически устанавливается на тему по умолчанию, связанную с выбранным шаблоном, если вы не выбрали *other*. Если вы выбрали *other*, тему можно определить из выпадающего списка на основе [Иерархии Тем WIS2](https://codes.wmo.int/wis/topic-hierarchy/_earth-system-discipline).

Для целей обучения вы создадите два набора данных:
    
- Набор данных с использованием Template=*weather/surface-based-observations/synop*, который включает плагины данных для преобразования данных в формат BUFR перед публикацией;
- Набор данных с использованием Template=*Other*, где вы сами определяете тему WIS2 и используете плагин "Universal" для публикации данных без преобразования.

## Template=weather/surface-based-observations/synop

Для **Template** выберите **weather/surface-based-observations/synop**:

<img alt="Форма создания нового набора данных: начальная информация" src="/../assets/img/wis2box-create-new-dataset-form-initial.png" width="450">

Нажмите *continue to form*, чтобы продолжить. Теперь вы увидите **Dataset Editor Form**.

Поскольку вы выбрали шаблон **weather/surface-based-observations/synop**, форма будет предварительно заполнена начальными значениями, связанными с этим типом данных.

### Создание метаданных для обнаружения

Форма Dataset Editor позволяет указать метаданные для обнаружения для вашего набора данных, которые контейнер wis2box-management будет использовать для публикации записи WCMP2.

Поскольку вы выбрали шаблон 'weather/surface-based-observations/synop', форма будет предварительно заполнена значениями по умолчанию.

Пожалуйста, замените автоматически сгенерированный 'Local ID' на описательное имя для вашего набора данных, например, 'synop-dataset-wis2training':

<img alt="Редактор метаданных: заголовок, описание, ключевые слова" src="/../assets/img/wis2box-metadata-editor-part1.png" width="800">

Проверьте заголовок и ключевые слова, обновите их при необходимости и укажите описание для вашего набора данных.

Обратите внимание, что есть опции для изменения 'WMO Data Policy' с 'core' на 'recommended' или для модификации идентификатора метаданных по умолчанию. Пожалуйста, оставьте политику данных как 'core' и используйте идентификатор метаданных по умолчанию.

Далее проверьте раздел, определяющий 'Temporal Properties' и 'Spatial Properties'. Вы можете настроить границы, обновив поля 'North Latitude', 'South Latitude', 'East Longitude' и 'West Longitude':

<img alt="Редактор метаданных: временные и пространственные свойства" src="/../assets/img/wis2box-metadata-editor-part2.png" width="800">

Затем заполните раздел, определяющий 'Contact Information of the Data Provider':

<img alt="Редактор метаданных: контактная информация" src="/../assets/img/wis2box-metadata-editor-part3.png" width="800">

Наконец, заполните раздел, определяющий 'Data Quality Information'.

После заполнения всех разделов нажмите 'VALIDATE FORM' и проверьте форму на наличие ошибок:

<img alt="Редактор метаданных: проверка" src="/../assets/img/wis2box-metadata-validation-error.png" width="800">

Если есть ошибки, исправьте их и снова нажмите 'VALIDATE FORM'.

Убедитесь, что ошибок нет, и вы получили всплывающее сообщение о том, что форма прошла проверку:

<img alt="Редактор метаданных: успешная проверка" src="/../assets/img/wis2box-metadata-validation-success.png" width="800">

Далее, перед отправкой вашего набора данных, проверьте соответствие данных для вашего набора данных.

### Настройка соответствия данных

Поскольку вы использовали шаблон для создания вашего набора данных, соответствие данных было предварительно заполнено плагинами по умолчанию для шаблона 'weather/surface-based-observations/synop'. Плагины данных используются в wis2box для преобразования данных перед их публикацией через уведомление WIS2.

<img alt="Соответствие данных: обновление плагина" src="/../assets/img/wis2box-data-mappings.png" width="800">

Обратите внимание, что вы можете нажать кнопку "update", чтобы изменить настройки плагина, такие как расширение файла и шаблон файла. На данный момент оставьте настройки по умолчанию. Это будет объяснено подробнее позже при создании пользовательского набора данных.

### Отправка вашего набора данных

Наконец, вы можете нажать 'submit', чтобы опубликовать ваш набор данных.

Вам потребуется предоставить токен авторизации для 'processes/wis2box', который вы создали ранее. Если вы этого еще не сделали, вы можете создать новый токен, следуя инструкциям в разделе подготовки.

Убедитесь, что после отправки вашего набора данных вы получили следующее сообщение, указывающее, что набор данных был успешно отправлен:

<img alt="Submit Dataset Success" src="/../assets/img/wis2box-submit-dataset-success.png" width="400">

После нажатия 'OK' вы будете перенаправлены на главную страницу редактора наборов данных. Теперь, если вы нажмете на вкладку 'Dataset', вы должны увидеть ваш новый набор данных в списке:

<img alt="Dataset Editor: new dataset" src="/../assets/img/wis2box-dataset-editor-new-dataset.png" width="800">

### Просмотр уведомления WIS2 для метаданных обнаружения

Перейдите в MQTT Explorer. Если вы были подключены к брокеру, вы должны увидеть новое уведомление WIS2, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`:

<img alt="MQTT Explorer: WIS2 notification" src="/../assets/img/mqtt-explorer-wis2-notification-metadata.png" width="800">

Изучите содержимое уведомления WIS2, которое вы опубликовали. Вы должны увидеть JSON со структурой, соответствующей формату WIS Notification Message (WNM).

!!! question

    В какой теме опубликовано уведомление WIS2?

??? success "Нажмите, чтобы увидеть ответ"

    Уведомление WIS2 опубликовано в теме `origin/a/wis2/<your-centre-id>/metadata`.

!!! question
    
    Попробуйте найти заголовок, описание и ключевые слова, которые вы указали в метаданных обнаружения, в уведомлении WIS2. Можете ли вы их найти?

??? success "Нажмите, чтобы увидеть ответ"

    **Заголовок, описание и ключевые слова, которые вы указали в метаданных обнаружения, отсутствуют в содержимом уведомления WIS2!** 
    
    Вместо этого попробуйте найти каноническую ссылку в разделе "links" уведомления WIS2:

    <img alt="WIS2 notification for metadata, links sections" src="/../assets/img/wis2-notification-metadata-links.png" width="800">

    **Уведомление WIS2 содержит каноническую ссылку на запись WCMP2, которая была опубликована.** 
    
    Скопируйте и вставьте эту каноническую ссылку в ваш браузер, чтобы получить доступ к записи WCMP2. В зависимости от настроек вашего браузера, вам может быть предложено скачать файл или он будет отображен непосредственно в браузере.

    Вы найдете заголовок, описание и ключевые слова, которые вы указали, внутри записи WCMP2.

wis2box предоставляет ограниченное количество предопределенных шаблонов. Эти шаблоны предназначены для общих типов наборов данных, но они могут не всегда соответствовать специализированным данным. Для всех других типов наборов данных вы можете создать свой набор данных, выбрав Template=*other*.

## Template=other

Далее мы создадим второй набор данных, используя Template=*other*.

Нажмите "Create New ..." снова, чтобы создать новый набор данных. Используйте тот же centre-id, который вы использовали ранее, он должен быть доступен в выпадающем списке. Для **Template** выберите **other**:

<img alt="Create New Dataset Form: Initial information" src="/../assets/img/wis2box-create-new-dataset-form-initial-other.png" width="450">

Нажмите *continue to form*, чтобы продолжить. Теперь вам будет представлена форма редактора набора данных (**Dataset Editor Form**), которая немного отличается от предыдущей.

### Создание метаданных обнаружения

Как и раньше, вам нужно будет заполнить обязательные поля в форме редактора набора данных, включая Title, Description и Local ID:

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/wis2box-metadata-editor-part1-other.png" width="800">

Обратите внимание, что поскольку вы выбрали Template=*other*, вам нужно самостоятельно определить иерархию тем WIS2, используя выпадающие списки для 'Discipline' и 'Sub-Discipline'.

Для этого упражнения выберите тему Sub-Discipline "prediction/analysis/medium-range/deterministic/global":

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/wis2box-metadata-editor-part1-other-topic.png" width="800">

Поскольку вы использовали Template=*other*, ключевые слова не были предопределены. Убедитесь, что вы добавили как минимум 3 ключевых слова на ваш выбор:

<img alt="Metadata Editor: title, description, keywords" src="/../assets/img/wis2box-metadata-editor-part1-other-2.png" width="800">

После заполнения обязательных полей заполните оставшиеся разделы формы, включая 'Temporal Properties', 'Spatial Properties' и 'Contact Information of the Data Provider', и убедитесь, что форма прошла проверку.

### Настройка сопоставлений данных

Когда используется пользовательский шаблон, предопределенные сопоставления данных не предоставляются. В результате редактор сопоставлений данных (**Dataset Mappings Editor**) будет пуст, и пользователям необходимо настроить сопоставления в соответствии с их конкретными требованиями.

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other1.png" width="800">

Нажмите "ADD A PLUGIN +" для добавления плагина данных в ваш набор данных.

Выберите плагин с именем **"Universal data without conversion"**. Этот плагин предназначен для публикации данных без применения каких-либо преобразований.

При добавлении этого плагина вам нужно будет указать **File Extension** и **File Pattern** (определяется регулярным выражением), который соответствует шаблону именования ваших файлов данных. В случае плагина "Universal" File Pattern также используется для определения свойства "datetime" для данных.

!!! Note "Извлечение даты и времени из имени файла"

    Плагин "Universal" предполагает, что первая группа в регулярном выражении соответствует дате и времени данных. 

    Шаблон по умолчанию — это `^.*?_(\d{8}).*?\..*$`, который соответствует 8 цифрам, предшествующим символу подчеркивания, и любым символам перед точкой и расширением файла. Например:

    - `mydata_20250101.txt` соответствует и извлекает 25 января 2025 года как свойство datetime для данных
    - `mydata_2025010112.txt` не соответствует, так как 10 цифр вместо 8
    - `mydata-20250101.txt` не соответствует, так как перед датой стоит дефис вместо подчеркивания

    При загрузке данных с использованием плагина "Universal" либо переименуйте ваши файлы в соответствии с шаблоном по умолчанию, либо обновите File Pattern, убедившись, что первая группа в регулярном выражении соответствует дате и времени.

Оставьте значения по умолчанию для "File Name" на данный момент, так как они соответствуют данным, которые вы будете загружать в следующей практической сессии:

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other2.png" width="800">

Нажмите "SAVE", чтобы сохранить настройки плагина, и убедитесь, что теперь вы видите плагин в списке редактора сопоставлений данных (**Dataset Mappings Editor**):

<img alt="Data Mappings: update plugin" src="/../assets/img/wis2box-data-mappings-other3.png" width="800">

Обратите внимание, что при загрузке данных расширение файла и шаблон имени файла должны соответствовать настройкам, которые вы указали здесь, иначе данные не будут обработаны, и контейнер wis2box-management зарегистрирует сообщения об ошибке (ERROR).

### Отправка и проверка результата

Наконец, предоставьте токен авторизации для 'processes/wis2box', который вы создали ранее, и нажмите 'submit', чтобы опубликовать ваш набор данных.

После успешной отправки ваш новый набор данных появится на вкладке Dataset:

<img alt="Dataset Editor: new dataset" src="/../assets/img/wis2box-dataset-editor-new-dataset-other.png" width="800">

Перейдите в MQTT Explorer. Если вы были подключены к вашему брокеру, вы должны увидеть еще одно новое уведомление WIS2, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`.

!!! question
    
    Зайдите в интерфейс wis2box-UI по адресу `http://YOUR-HOST`. Сколько наборов данных вы видите в списке? Как можно просмотреть иерархию тем WIS2 для каждого набора данных и как можно увидеть описание каждого набора данных?

??? success "Нажмите, чтобы увидеть ответ"

    Открыв интерфейс wis2box UI по адресу `http://YOUR-HOST`, вы должны увидеть 2 набора данных в списке вместе с их иерархией тем WIS2. Чтобы увидеть описание каждого набора данных, вы можете нажать на "metadata", что перенаправит вас на соответствующий элемент 'discovery-metadata', предоставляемый wis2box-api.

!!! question

    Попробуйте обновить описание последнего созданного набора данных. После обновления описания видите ли вы новое уведомление WIS2, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`? В чем разница между новым уведомлением и предыдущим?

??? success "Нажмите, чтобы увидеть ответ"

    Вы должны увидеть новое сообщение об уведомлении данных после обновления вашего набора данных в теме `origin/a/wis2/<your-centre-id>/metadata`.
    
    В сообщении значение *"rel": "canonical"* изменится на *"rel": "update"*, указывая на то, что ранее опубликованные данные были изменены. Чтобы увидеть обновленное описание, скопируйте и вставьте URL в ваш браузер, и вы должны увидеть обновленное описание.

!!! question

    Попробуйте обновить иерархию тем последнего созданного набора данных, изменив выбор в "Sub-Discipline Topics". Видите ли вы новое уведомление WIS2, опубликованное в теме `origin/a/wis2/<your-centre-id>/metadata`?

??? success "Нажмите, чтобы увидеть ответ"

Вы **не можете** обновить иерархию тем для существующего набора данных. Поле "Иерархия тем" отключено в форме редактора набора данных после его создания. Если вы хотите использовать другую иерархию тем, сначала удалите существующий набор данных, а затем создайте новый набор данных с желаемой иерархией тем.

## Заключение

!!! success "Поздравляем!"
    В ходе этой практической сессии вы научились:

    - использовать редактор наборов данных в `wis2box-webapp`
    - создавать новые наборы данных, используя Template=*weather/surface-based-observations/synop* и Template=*other*
    - определять метаданные для обнаружения
    - проверять сопоставления данных
    - публиковать метаданные для обнаружения
    - проверять уведомления WIS2 для ваших метаданных обнаружения