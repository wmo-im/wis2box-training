---
title: Декодирование данных из бинарных форматов ВМО
---

# Декодирование данных из бинарных форматов ВМО

!!! abstract "Результаты обучения!"

    К концу этой практической сессии вы сможете:

    - запустить Docker-контейнер для образа "demo-decode-eccodes-jupyter"
    - запустить пример Jupyter-ноутбуков для декодирования данных в форматах GRIB2, NetCDF и BUFR
    - узнать о других инструментах для декодирования и визуализации форматов, основанных на таблицах ВМО (TDCF)

## Введение

Бинарные форматы ВМО, такие как BUFR и GRIB, широко используются в метеорологическом сообществе для обмена данными наблюдений и моделирования. Для их декодирования и визуализации обычно требуются специализированные инструменты.

После загрузки данных из WIS2 вам часто потребуется декодировать их для дальнейшего использования.

Существуют различные библиотеки кода, которые позволяют писать скрипты или программы для декодирования бинарных форматов ВМО. Также доступны инструменты с пользовательским интерфейсом, которые позволяют декодировать и визуализировать данные без необходимости написания программного обеспечения.

В этой практической сессии мы продемонстрируем, как декодировать три различных типа данных с использованием Jupyter-ноутбука:

- GRIB2, содержащий данные для глобального ансамблевого прогноза, созданного системой CMA Global Regional Assimilation PrEdiction System (GRAPES)
- BUFR, содержащий данные о треках тропических циклонов из системы ансамблевого прогнозирования ECMWF
- NetCDF, содержащий данные о месячных аномалиях температуры

## Декодирование загруженных данных в Jupyter-ноутбуке

Для демонстрации декодирования загруженных данных мы запустим новый контейнер с использованием образа 'decode-bufr-jupyter'.

Этот контейнер запустит сервер Jupyter-ноутбуков на вашей виртуальной машине, который включает библиотеку [ecCodes](https://sites.ecmwf.int/docs/eccodes), используемую для декодирования данных BUFR.

Мы будем использовать пример ноутбуков, находящихся в `~/exercise-materials/notebook-examples`, чтобы декодировать загруженные данные о треках циклонов.

Для запуска контейнера используйте следующую команду:

```bash
docker run -d --name demo-decode-eccodes-jupyter \
    -v ~/wis2box-data/downloads:/root/downloads \
    -p 8888:8888 \
    -e JUPYTER_TOKEN=dataismagic! \
    ghcr.io/wmo-im/wmo-im/demo-decode-eccodes-jupyter:latest
```

Разбор команды:

- `docker run -d --name demo-decode-eccodes-jupyter` запускает новый контейнер в фоновом режиме (`-d`) и задает ему имя `demo-decode-eccodes-jupyter`
- `-v ~/wis2box-data/downloads:/root/downloads` монтирует директорию `~/wis2box-data/downloads` на вашей виртуальной машине в `/root/downloads` в контейнере. Здесь хранятся данные, загруженные из WIS2
- `-p 8888:8888` отображает порт 8888 на вашей виртуальной машине на порт 8888 в контейнере. Это делает сервер Jupyter-ноутбуков доступным в вашем веб-браузере по адресу `http://YOUR-HOST:8888`
- `-e JUPYTER_TOKEN=dataismagic!` задает токен, необходимый для доступа к серверу Jupyter-ноутбуков. Этот токен потребуется при доступе к серверу через веб-браузер
- `ghrc.io/wmo-im/demo-decode-eccodes-jupyter:latest` указывает образ, используемый контейнером, который включает пример Jupyter-ноутбуков для следующих упражнений

!!! note "О контейнере demo-decode-eccodes-jupyter"

    Образ `demo-decode-eccodes-jupyter` разработан для этого обучения и использует базовый образ с библиотекой ecCodes, добавляя сервер Jupyter-ноутбуков, а также пакеты Python для анализа и визуализации данных.

    Исходный код этого образа, включая пример ноутбуков, доступен по адресу [wmo-im/demo-decode-eccodes-jupyter](https://github.com/wmo-im/demo-decode-eccodes-jupyter).
    
После запуска контейнера вы можете получить доступ к серверу Jupyter-ноутбуков на вашей виртуальной машине, перейдя по адресу `http://YOUR-HOST:8888` в вашем веб-браузере.

Вы увидите экран с запросом "Password or token".

Введите токен `dataismagic!`, чтобы войти на сервер Jupyter-ноутбуков (если вы не использовали другой токен в команде выше).

После входа вы увидите следующий экран с перечнем директорий в контейнере:

![Jupyter notebook home](../assets/img/jupyter-files-screen1.png)

Дважды щелкните на директорию `example-notebooks`, чтобы открыть ее. Вы увидите следующий экран с перечнем примерных ноутбуков:

![Jupyter notebook example notebooks](../assets/img/jupyter-files-screen2.png)

Теперь вы можете открыть примерные ноутбуки для декодирования загруженных данных.

### Пример декодирования GRIB2: данные GEPS из CMA GRAPES

Откройте файл `GRIB2_CMA_global_ensemble_prediction.ipynb` в директории `example-notebooks`:

![Jupyter notebook GRIB2 global ensemble prediction](../assets/img/jupyter-grib2-global-ensemble-prediction.png)

Прочитайте инструкции в ноутбуке и выполните ячейки, чтобы декодировать загруженные данные для глобального ансамблевого прогноза. Выполняйте каждую ячейку, щелкая на нее и нажимая кнопку запуска на панели инструментов или нажимая `Shift+Enter`.

После выполнения всех ячеек вы увидите визуализацию одного из вероятностных прогнозов аномалии температуры, содержащихся в данных GRIB2:

![Global ensemble prediction temperature anomaly](../assets/img/grib2-global-ensemble-prediction-map.png)

!!! question 

    Как вы бы обновили визуализацию в этом ноутбуке, чтобы отобразить прогноз для "Скорости ветра (порывы)"?

??? success "Нажмите, чтобы увидеть ответ"

    Чтобы обновить ноутбук, найдите следующую строку:

    ```python
    my_parameter_name = "Temperature anomaly"
    ```

    и измените ее на:

    ```python
    my_parameter_name = "Wind speed (gust)"
    ```

    Затем выполните ячейки ноутбука заново, чтобы увидеть обновленный график.

### Пример декодирования BUFR: треки тропических циклонов

Откройте файл `BUFR_tropical_cyclone_track.ipynb` в директории `example-notebooks`:

![Jupyter notebook tropical cyclone track](../assets/img/jupyter-tropical-cyclone-track.png)

Прочитайте инструкции в ноутбуке и выполните ячейки, чтобы декодировать загруженные данные о треках тропических циклонов. Выполняйте каждую ячейку, щелкая на нее и нажимая кнопку запуска на панели инструментов или нажимая `Shift+Enter`.

В конце вы увидите график вероятности удара для тропических циклонов:

![Tropical cyclone tracks](../assets/img/tropical-cyclone-track-map.png)

!!! question 

    Результат отображает прогнозируемую вероятность трека тропического шторма в пределах 200 км. Как вы бы обновили ноутбук, чтобы отобразить вероятность трека в пределах 300 км?

??? success "Нажмите, чтобы увидеть ответ"

    Чтобы обновить ноутбук для отображения вероятности трека тропического шторма в пределах другого расстояния, обновите переменную `distance_threshold` в блоке кода, который рассчитывает вероятность удара.

    Чтобы отобразить вероятность трека в пределах 300 км:

    ```python
    # set distance threshold (meters)
    distance_threshold = 300000  # 300 км в метрах
    ```

    Затем выполните ячейки ноутбука заново, чтобы увидеть обновленный график.

!!! note "Декодирование данных BUFR"

    Упражнение, которое вы только что выполнили, предоставило конкретный пример декодирования данных BUFR с использованием библиотеки ecCodes. Разные типы данных могут требовать различных шагов декодирования, и вам может понадобиться обратиться к документации для типа данных, с которым вы работаете.
    
    Для получения дополнительной информации обратитесь к [документации ecCodes](https://confluence.ecmwf.int/display/ECC).

### Пример декодирования NetCDF: месячные аномалии температуры

Откройте файл `NetCDF4_monthly_temperature_anomaly.ipynb` в директории `example-notebooks`:

![Jupyter notebook monthly temperature anomalies](../assets/img/jupyter-netcdf4-monthly-temperature-anomalies.png)

Прочитайте инструкции в ноутбуке и выполните ячейки, чтобы декодировать загруженные данные о месячных аномалиях температуры. Выполняйте каждую ячейку, щелкая на нее и нажимая кнопку запуска на панели инструментов или нажимая `Shift+Enter`.

В конце вы увидите карту аномалий температуры:

![Monthly temperature anomalies](../assets/img/netcdf4-monthly-temperature-anomalies-map.png)

!!! note "Декодирование данных NetCDF"

    Формат NetCDF является гибким и в данном примере содержит значения для переменной 'anomaly', представленные по измерениям 'lat', 'lon'. Разные наборы данных NetCDF могут использовать разные имена переменных и измерений.

## Использование других инструментов для просмотра и декодирования бинарных форматов ВМО

Примерные ноутбуки продемонстрировали, как можно декодировать широко используемые бинарные форматы ВМО с использованием Python.

Вы также можете использовать другие инструменты для декодирования и визуализации форматов, основанных на таблицах ВМО, без необходимости написания программного обеспечения, такие как:

- [Panoply](https://www.giss.nasa.gov/tools/panoply/) — кроссплатформенное приложение для построения географически привязанных и других массивов из NetCDF, HDF, GRIB и других наборов данных
- [ECMWF Metview](https://confluence.ecmwf.int/display/METV/Metview) — метеорологическое приложение для анализа и визуализации данных, поддерживающее форматы GRIB и BUFR
- [Integrated Data Viewer (IDV)](https://www.unidata.ucar.edu/software/idv/) — бесплатная программная платформа на Java для анализа и визуализации данных геонаук, включая поддержку форматов GRIB и NetCDF

## Заключение

!!! success "Поздравляем!"

    В этой практической сессии вы научились:

    - запускать Docker-контейнер для образа "demo-decode-eccodes-jupyter"
    - запускать примерные Jupyter-ноутбуки для декодирования данных в форматах GRIB2, NetCDF и BUFR