---
title: Добавление заголовков GTS в уведомления WIS2
---

# Добавление заголовков GTS в уведомления WIS2

!!! abstract "Учебные результаты"

    К концу этой практической сессии вы сможете:
    
    - настроить соответствие между именем файла и заголовками GTS
    - загрузить данные с именем файла, соответствующим заголовкам GTS
    - просмотреть заголовки GTS в уведомлениях WIS2

## Введение

Члены ВМО, желающие прекратить передачу данных по GTS в переходный период к WIS2, должны добавить заголовки GTS в свои уведомления WIS2. Эти заголовки позволяют шлюзу WIS2 к GTS пересылать данные в сеть GTS.

Это позволяет членам, перешедшим на использование узла WIS2 для публикации данных, отключить свою систему MSS и гарантировать, что их данные все еще доступны членам, которые еще не перешли на WIS2.

Свойство GTS в сообщении уведомления WIS2 должно быть добавлено как дополнительное свойство к сообщению уведомления WIS2. Свойство GTS представляет собой объект JSON, который содержит необходимые заголовки GTS для пересылки данных в сеть GTS.

```json
{
  "gts": {
    "ttaaii": "FTAE31",
    "cccc": "VTBB"
  }
}
```

В рамках wis2box вы можете автоматически добавить это в уведомления WIS2, предоставив дополнительный файл с именем `gts_headers_mapping.csv`, который содержит необходимую информацию для сопоставления заголовков GTS с входящими именами файлов.

Этот файл должен быть размещен в каталоге, определенном `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`, и должен иметь следующие столбцы:

- `string_in_filepath`: строка, которая является частью имени файла, которая будет использоваться для сопоставления с заголовками GTS
- `TTAAii`: заголовок TTAAii, который должен быть добавлен в уведомление WIS2
- `CCCC`: заголовок CCCC, который должен быть добавлен в уведомление WIS2

## Подготовка

Убедитесь, что у вас есть доступ по SSH к вашей учебной виртуальной машине и что ваш экземпляр wis2box работает.

Убедитесь, что вы подключены к брокеру MQTT вашего экземпляра wis2box с использованием MQTT Explorer. Вы можете использовать общедоступные учетные данные `everyone/everyone` для подключения к брокеру.

Убедитесь, что у вас открыт веб-браузер с дашбордом Grafana для вашего экземпляра, перейдя по адресу `http://YOUR-HOST:3000`

## создание `gts_headers_mapping.csv`

Для добавления заголовков GTS в уведомления WIS2 требуется CSV-файл, который сопоставляет заголовки GTS с входящими именами файлов.

CSV-файл должен быть назван (точно) `gts_headers_mapping.csv` и должен быть размещен в каталоге, определенном `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`. 

## Предоставление файла `gts_headers_mapping.csv`
    
Скопируйте файл `exercise-materials/gts-headers-exercises/gts_headers_mapping.csv` в ваш экземпляр wis2box и разместите его в каталоге, определенном `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`.

```bash
cp ~/exercise-materials/gts-headers-exercises/gts_headers_mapping.csv ~/wis2box-data
```

Затем перезапустите контейнер wis2box-management, чтобы применить изменения:

```bash
docker restart wis2box-management
```

## Загрузка данных с заголовками GTS

Скопируйте файл `exercise-materials/gts-headers-exercises/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt` в каталог, определенный `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`:

```bash
cp ~/exercise-materials/gts-headers-exercises/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt ~/wis2box-data
```

Затем войдите в контейнер **wis2box-management**:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

Из командной строки wis2box мы можем загрузить образец файла данных `A_SMRO01YRBK171200_C_EDZW_20240717120502.txt` в определенный набор данных следующим образом:

```bash
wis2box data ingest -p /data/wis2box/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt --metadata-id urn:wmo:md:not-my-centre:core.surface-based-observations.synop
```

Убедитесь, что вы заменили параметр `metadata-id` на правильный идентификатор для вашего набора данных.

Проверьте дашборд Grafana, чтобы увидеть, были ли данные загружены правильно. Если вы видите какие-либо ПРЕДУПРЕЖДЕНИЯ или ОШИБКИ, попробуйте их исправить и повторите команду `wis2box data ingest`.

## Просмотр заголовков GTS в уведомлении WIS2

Перейдите в MQTT Explorer и проверьте сообщение уведомления WIS2 для данных, которые вы только что загрузили.

Сообщение уведомления WIS2 должно содержать заголовки GTS, которые вы указали в файле `gts_headers_mapping.csv`.

## Заключение

!!! success "Поздравляем!"
    В ходе этой практической сессии вы научились:
      - добавлять заголовки GTS в уведомления WIS2
      - проверять, что заголовки GTS доступны через вашу установку wis2box