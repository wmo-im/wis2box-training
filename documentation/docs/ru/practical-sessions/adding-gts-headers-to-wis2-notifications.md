---
title: Добавление заголовков GTS к уведомлениям WIS2
---

# Добавление заголовков GTS к уведомлениям WIS2

!!! abstract "Результаты обучения"

    По завершении этого практического занятия вы сможете:
    
    - настроить сопоставление между именем файла и заголовками GTS
    - загружать данные с именем файла, соответствующим заголовкам GTS
    - просматривать заголовки GTS в уведомлениях WIS2

## Введение

Членам ВМО, желающим прекратить передачу данных по GTS в переходный период к WIS2, потребуется добавить заголовки GTS к своим уведомлениям WIS2. Эти заголовки позволяют шлюзу WIS2-GTS пересылать данные в сеть GTS.

Это позволяет Членам, перешедшим на использование узла WIS2 для публикации данных, отключить свою систему MSS и обеспечить доступность их данных для Членов, еще не перешедших на WIS2.

Свойство GTS в Сообщении Уведомления WIS2 должно быть добавлено как дополнительное свойство к Сообщению Уведомления WIS2. Свойство GTS представляет собой JSON-объект, содержащий заголовки GTS, необходимые для пересылки данных в сеть GTS.

```json
{
  "gts": {
    "ttaaii": "FTAE31",
    "cccc": "VTBB"
  }
}
```

В wis2box вы можете автоматически добавлять это к Уведомлениям WIS2, предоставив дополнительный файл с названием `gts_headers_mapping.csv`, который содержит необходимую информацию для сопоставления заголовков GTS с входящими именами файлов.

Этот файл должен быть размещен в директории, определенной параметром `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`, и должен содержать следующие столбцы:

- `string_in_filepath`: строка, являющаяся частью имени файла, которая будет использоваться для сопоставления с заголовками GTS
- `TTAAii`: заголовок TTAAii, который будет добавлен к уведомлению WIS2
- `CCCC`: заголовок CCCC, который будет добавлен к уведомлению WIS2

## Подготовка

Убедитесь, что у вас есть SSH-доступ к вашей учебной виртуальной машине и что ваш экземпляр wis2box запущен и работает.

Убедитесь, что вы подключены к MQTT-брокеру вашего экземпляра wis2box с помощью MQTT Explorer. Для подключения к брокеру можно использовать публичные учетные данные `everyone/everyone`.

Убедитесь, что у вас открыт веб-браузер с панелью Grafana для вашего экземпляра, перейдя по адресу `http://YOUR-HOST:3000`

## Создание `gts_headers_mapping.csv`

Для добавления заголовков GTS к вашим уведомлениям WIS2 требуется CSV-файл, который сопоставляет заголовки GTS с входящими именами файлов.

CSV-файл должен иметь точное название `gts_headers_mapping.csv` и должен быть размещен в директории, определенной параметром `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`. 

## Предоставление файла `gts_headers_mapping.csv`
    
Скопируйте файл `exercise-materials/gts-headers-exercises/gts_headers_mapping.csv` в ваш экземпляр wis2box и поместите его в директорию, определенную параметром `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`.

```bash
cp ~/exercise-materials/gts-headers-exercises/gts_headers_mapping.csv ~/wis2box-data
```

Затем перезапустите контейнер wis2box-management, чтобы применить изменения:

```bash
docker restart wis2box-management
```

## Загрузка данных с заголовками GTS

Скопируйте файл `exercise-materials/gts-headers-exercises/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt` в директорию, определенную параметром `WIS2BOX_HOST_DATADIR` в вашем `wis2box.env`:

```bash
cp ~/exercise-materials/gts-headers-exercises/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt ~/wis2box-data
```

Затем войдите в контейнер **wis2box-management**:

```bash
cd ~/wis2box
python3 wis2box-ctl.py login
```

Из командной строки wis2box мы можем загрузить образец файла данных `A_SMRO01YRBK171200_C_EDZW_20240717120502.txt` в определенный набор данных следующим образом:

```bash
wis2box data ingest -p /data/wis2box/A_SMRO01YRBK171200_C_EDZW_20240717120502.txt --metadata-id urn:wmo:md:not-my-centre:core.surface-based-observations.synop
```

Убедитесь, что заменили опцию `metadata-id` правильным идентификатором для вашего набора данных.

Проверьте панель Grafana, чтобы убедиться, что данные были загружены корректно. Если вы видите какие-либо ПРЕДУПРЕЖДЕНИЯ или ОШИБКИ, попытайтесь исправить их и повторите упражнение с командой `wis2box data ingest`.

## Просмотр заголовков GTS в Уведомлении WIS2

Перейдите в MQTT Explorer и проверьте Сообщение Уведомления WIS2 для только что загруженных данных.

Сообщение Уведомления WIS2 должно содержать заголовки GTS, которые вы указали в файле `gts_headers_mapping.csv`.

## Заключение

!!! success "Поздравляем!"
    В этом практическом занятии вы научились:
      - добавлять заголовки GTS к вашим уведомлениям WIS2
      - проверять, что заголовки GTS доступны через вашу установку wis2box