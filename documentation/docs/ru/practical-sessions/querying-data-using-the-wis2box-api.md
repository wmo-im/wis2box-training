---
title: Запрос данных через API wis2box
---

# Запрос данных через API wis2box

!!! abstract "Результаты обучения"
    По завершении этого практического занятия вы сможете:

    - использовать API wis2box для запроса и фильтрации ваших станций
    - использовать API wis2box для запроса и фильтрации ваших данных

## Введение

API wis2box обеспечивает доступ к поиску и запросу данных, загруженных в wis2box, в машиночитаемом формате. API основан на стандарте OGC API - Features и реализован с использованием [pygeoapi](https://pygeoapi.io).

API wis2box предоставляет доступ к следующим коллекциям:

- Станции
- Метаданные обнаружения
- Уведомления о данных
- плюс одна коллекция на каждый настроенный набор данных, которая хранит вывод из bufr2geojson (плагин `bufr2geojson` должен быть включен в конфигурации сопоставления данных для заполнения элементов в коллекции набора данных).

В этом практическом занятии вы научитесь использовать API данных для просмотра и запроса данных, загруженных в wis2box.

## Подготовка

!!! note
    Перейдите на главную страницу API wis2box в вашем веб-браузере:

    `http://YOUR-HOST/oapi`

<img alt="wis2box-api-landing-page" src="../../assets/img/wis2box-api-landing-page.png" width="600">

## Проверка коллекций

На главной странице нажмите на ссылку 'Collections'.

!!! question
    Сколько коллекций наборов данных вы видите на результирующей странице? Как вы думаете, что представляет каждая коллекция?

??? success "Нажмите, чтобы увидеть ответ"
    Должно отображаться 4 коллекции, включая "Stations", "Discovery metadata" и "Data notifications"

## Проверка станций

На главной странице нажмите на ссылку 'Collections', затем нажмите на ссылку 'Stations'.

<img alt="wis2box-api-collections-stations" src="../../assets/img/wis2box-api-collections-stations.png" width="600">

Нажмите на ссылку 'Browse', затем на ссылку 'json'.

!!! question
    Сколько станций возвращается? Сравните это число со списком станций в `http://YOUR-HOST/wis2box-webapp/station`

??? success "Нажмите, чтобы увидеть ответ"
    Количество станций из API должно быть равно количеству станций, которые вы видите в веб-приложении wis2box.

!!! question
    Как мы можем запросить одну станцию (например, `Balaka`)?

??? success "Нажмите, чтобы увидеть ответ"
    Запросите API с помощью `http://YOUR-HOST/oapi/collections/stations/items?q=Balaka`.

!!! note
    Приведенный выше пример основан на тестовых данных Малави. Попробуйте протестировать станции, которые вы загрузили в рамках предыдущих упражнений.

## Проверка наблюдений

!!! note
    Приведенный выше пример основан на тестовых данных Малави. Попробуйте протестировать наблюдения, которые вы загрузили в рамках упражнений.

На главной странице нажмите на ссылку 'Collections', затем нажмите на ссылку 'Surface weather observations from Malawi'.

<img alt="wis2box-api-collections-malawi-obs" src="../../assets/img/wis2box-api-collections-malawi-obs.png" width="600">

Нажмите на ссылку 'Queryables'.

<img alt="wis2box-api-collections-malawi-obs-queryables" src="../../assets/img/wis2box-api-collections-malawi-obs-queryables.png" width="600">

!!! question
    Какой параметр запроса следует использовать для фильтрации по идентификатору станции?

??? success "Нажмите, чтобы увидеть ответ"
    Правильный параметр запроса - `wigos_station_identifer`.

Вернитесь на предыдущую страницу (т.е. `http://YOUR-HOST/oapi/collections/urn:wmo:md:mwi:mwi_met_centre:surface-weather-observations`)

Нажмите на ссылку 'Browse'.

!!! question
    Как мы можем визуализировать ответ JSON?

??? success "Нажмите, чтобы увидеть ответ"
    Нажав на ссылку 'JSON' в правом верхнем углу страницы или добавив `f=json` к запросу API в веб-браузере.

Проверьте JSON-ответ наблюдений.

!!! question
    Сколько записей возвращается?

!!! question
    Как мы можем ограничить ответ 3 наблюдениями?

??? success "Нажмите, чтобы увидеть ответ"
    Добавьте `limit=3` к запросу API.

!!! question
    Как мы можем отсортировать ответ по последним наблюдениям?

??? success "Нажмите, чтобы увидеть ответ"
    Добавьте `sortby=-resultTime` к запросу API (обратите внимание на знак `-` для обозначения убывающего порядка сортировки). Для сортировки по самым ранним наблюдениям обновите запрос, включив `sortby=resultTime`.

!!! question
    Как мы можем отфильтровать наблюдения по одной станции?

??? success "Нажмите, чтобы увидеть ответ"
    Добавьте `wigos_station_identifier=<WSI>` к запросу API.

!!! question
    Как мы можем получить наблюдения в формате CSV?

??? success "Нажмите, чтобы увидеть ответ"
    Добавьте `f=csv` к запросу API.

!!! question
    Как мы можем показать одно наблюдение (id)?

??? success "Нажмите, чтобы увидеть ответ"
    Используя идентификатор объекта из запроса API к наблюдениям, запросите API по адресу `http://YOUR-HOST/oapi/collections/{collectionId}/items/{featureId}`, где `{collectionId}` - это название вашей коллекции наблюдений, а `{itemId}` - идентификатор интересующего вас отдельного наблюдения.

## Заключение

!!! success "Поздравляем!"
    В этом практическом занятии вы научились:

    - использовать API wis2box для запроса и фильтрации ваших станций
    - использовать API wis2box для запроса и фильтрации ваших данных