---
title: Преобразование данных SYNOP в BUFR
---

# Преобразование данных SYNOP в BUFR с использованием wis2box-webapp

!!! abstract "Учебные результаты"
    К концу этого практического занятия вы сможете:

    - отправлять действительные бюллетени FM-12 SYNOP через веб-приложение wis2box для преобразования в BUFR и обмена через WIS2.0;
    - проверять, диагностировать и исправлять простые ошибки кодирования в бюллетене FM-12 SYNOP перед преобразованием формата и обменом;
    - убедиться, что необходимые метаданные станции доступны в wis2box;
    - подтвердить и проверить успешно преобразованные бюллетени.

## Введение

Чтобы позволить ручным наблюдателям напрямую отправлять данные в WIS2.0, веб-приложение wis2box имеет форму для преобразования бюллетеней FM-12 SYNOP в BUFR. Форма также позволяет пользователям диагностировать и исправлять простые ошибки кодирования в бюллетене FM-12 SYNOP перед преобразованием формата и обменом и проверять полученные данные BUFR.

## Подготовка

!!! warning "Предварительные требования"

    - Убедитесь, что ваш wis2box настроен и запущен.
    - Откройте терминал и подключитесь к вашей студенческой виртуальной машине с помощью SSH.
    - Подключитесь к брокеру MQTT вашего экземпляра wis2box с помощью MQTT Explorer.
    - Откройте веб-приложение wis2box (``http://<your-host-name>/wis2box-webapp``) и убедитесь, что вы вошли в систему.

## Использование wis2box-webapp для преобразования FM-12 SYNOP в BUFR

### Упражнение 1 - использование wis2box-webapp для преобразования FM-12 SYNOP в BUFR

Убедитесь, что у вас есть токен аутентификации для "processes/wis2box", который вы сгенерировали в предыдущем упражнении, и что вы подключены к вашему брокеру wis2box в MQTT Explorer.

Скопируйте следующее сообщение:
    
``` {.copy}
AAXX 27031
15015 02999 02501 10103 21090 39765 42952 57020 60001=
``` 

Откройте веб-приложение wis2box и перейдите на страницу synop2bufr, используя левое навигационное меню, и продолжите следующим образом:

- Вставьте скопированный текст в текстовое поле.
- Выберите месяц и год с помощью селектора дат, предполагая текущий месяц для этого упражнения.
- Выберите тему из выпадающего меню (варианты основаны на настроенных наборах данных в wis2box).
- Введите токен аутентификации "processes/wis2box", который вы сгенерировали ранее.
- Убедитесь, что переключатель "Опубликовать в WIS2" включен.
- Нажмите "ОТПРАВИТЬ".

<center><img alt="Диалоговое окно, показывающее страницу synop2bufr, включая переключатель" src="../../assets/img/synop2bufr-toggle.png"></center>

Нажмите отправить. Вы получите предупреждающее сообщение, так как станция не зарегистрирована в wis2box. Перейдите в редактор станций и импортируйте следующую станцию:

``` {.copy}
0-20000-0-15015
```

Убедитесь, что станция ассоциирована с выбранной вами темой на предыдущем шаге, затем вернитесь на страницу synop2bufr и повторите процесс с теми же данными, что и ранее.

!!! question
    Как вы можете увидеть результат преобразования из FM-12 SYNOP в BUFR?

??? success "Нажмите, чтобы увидеть ответ"
    Раздел результатов страницы показывает предупреждения, ошибки и выходные файлы BUFR.

    Нажмите на "Выходные файлы BUFR", чтобы увидеть список сгенерированных файлов. Вы должны увидеть один файл в списке.

    Кнопка загрузки позволяет скачать данные BUFR напрямую на ваш компьютер.

    Кнопка проверки запускает процесс для преобразования и извлечения данных из BUFR.

    <center><img alt="Диалоговое окно, показывающее результат успешной отправки сообщения"
         src="../../assets/img/synop2bufr-ex2-success.png"></center>

!!! question
    Входные данные FM-12 SYNOP не включали местоположение станции, высоту над уровнем моря или высоту барометра.
    Подтвердите, что эти данные есть в выходных данных BUFR, откуда они взялись?

??? success "Нажмите, чтобы увидеть ответ"
    Нажатие кнопки проверки должно вызвать диалоговое окно, подобное показанному ниже.

    <center><img alt="Результаты нажатия кнопки проверки, показывающие основные метаданные станции, местоположение станции и наблюдаемые свойства"
         src="../../assets/img/synop2bufr-ex2.png"></center>

    Это включает в себя местоположение станции, показанное на карте, и основные метаданные, а также наблюдения в сообщении.
    
    В рамках преобразования из FM-12 SYNOP в BUFR в файл BUFR были добавлены дополнительные метаданные.
    
    Файл BUFR также можно проверить, загрузив файл и проверив его с помощью такого инструмента, как валидатор BUFR ECMWF ecCodes.

Перейдите в MQTT Explorer и проверьте тему уведомлений WIS2, чтобы увидеть опубликованные уведомления WIS2.

### Упражнение 2 - понимание списка станций

В этом следующем упражнении вы преобразуете файл, содержащий несколько отчетов, см. данные ниже:

``` {.copy}
AAXX 27031
15015 02999 02501 10103 21090 39765 42952 57020 60001=
15020 02997 23104 10130 21075 30177 40377 58020 60001 81041=
15090 02997 53102 10139 21075 30271 40364 58031 60001 82046=
```

!!! question
    Исходя из предыдущего упражнения, посмотрите на сообщение FM-12 SYNOP и предскажите, сколько выходных сообщений BUFR будет сгенерировано.
    
    Теперь скопируйте это сообщение в форму SYNOP и отправьте данные.

    Соответствует ли количество сгенерированных сообщений вашим ожиданиям и если нет, почему?

??? warning "Нажмите, чтобы увидеть ответ"
    
    Вы могли ожидать, что будут сгенерированы три сообщения BUFR, по одному для каждого погодного отчета. Однако вместо этого вы получили 2 предупреждения и только один файл BUFR.
    
    Для того чтобы погодный отчет мог быть преобразован в BUFR, необходимы основные метаданные, содержащиеся в списке станций. Хотя в приведенном выше примере приведены три погодных отчета, две из трех станций, предоставляющих отчеты, не были зарегистрированы в вашем wis2box.
    
    В результате только один из трех погодных отчетов привел к генерации файла BUFR и публикации уведомления WIS2. Два других погодных отчета были проигнорированы, и были сгенерированы предупреждения.

!!! hint
    Обратите внимание на связь между идентификатором WIGOS и традиционным идентификатором станции, включенным в выходные данные BUFR. Во многих случаях, для станций, перечисленных в WMO-No. 9 Том A на момент перехода на идентификаторы станций WIGOS, идентификатор станции WIGOS задается путем добавления ``0-20000-0`` перед традиционным идентификатором станции, например, ``15015`` становится ``0-20000-0-15015``.

Используя страницу списка станций, импортируйте следующие станции:

``` {.copy}
0-20000-0-15020
0-20000-0-15090
```

Убедитесь, что станции ассоциированы с темой, которую вы выбрали в предыдущем упражнении, затем вернитесь на страницу synop2bufr и повторите процесс.

Теперь должны быть сгенерированы три файла BUFR, и в веб-приложении не должно быть перечислено никаких предупреждений или ошибок.

Помимо основной информации о станции, дополнительные метаданные, такие как высота станции над уровнем моря и высота барометра над уровнем моря, требуются для кодирования в BUFR. Эти поля включены в страницы списка станций и редактора станций.
    
### Упражнение 3 - отладка

В этом последнем упражнении вы определите и исправите две наиболее распространенные проблемы, с которыми сталкиваются при использовании этого инструмента для преобразования FM-12 SYNOP в BUFR.

Пример данных показан в поле ниже, изучите данные и попытайтесь устранить любые проблемы, которые могут быть, перед отправкой данных через веб-приложение.

!!! hint
    Вы можете редактировать данные в текстовом поле на странице веб-приложения. Если вы пропустите какие-либо проблемы, они должны быть обнаружены и выделены как предупреждение или ошибка после нажатия кнопки отправки.

``` {.copy}
AAXX 27031
15015 02999 02501 10103 21090 39765 42952 57020 60001
15020 02997 23104 10130 21075 30177 40377 58020 60001 81041=
15090 02997 53102 10139 21075 30271 40364 58031 60001 82046=
```

!!! question
    Какие проблемы вы ожидали столкнуться при преобразовании данных в BUFR и как вы их преодолели? Были ли проблемы, которых вы не ожидали?

??? success "Нажмите, чтобы увидеть ответ"
    В этом первом примере отсутствует символ "конец текста" (=) или разделитель записей между первым и вторым погодными отчетами. Следовательно, строки 2 и 3 рассматриваются как один отчет, что приводит к ошибкам в анализе сообщения.

Второй пример ниже содержит несколько распространенных проблем, найденных в отчетах FM-12 SYNOP. Изучите данные и попытайтесь определить проблемы, затем отправьте исправленные данные через веб-приложение.

```{.copy}
AAXX 27031
15020 02997 23104 10/30 21075 30177 40377 580200 60001 81041=
```

!!! question
    Какие проблемы вы нашли и как вы их решили?

??? success "Нажмите, чтобы увидеть ответ"
    В погодном отчете есть две проблемы.
    
    Первая, в группе с указанием температуры воздуха, имеет десятый символ, установленный как отсутствующий (/), что приводит к недействительной группе. В этом примере мы знаем, что температура составляет 13,0 градусов Цельсия (из предыдущих примеров), поэтому эту проблему можно исправить. Оперативно правильное значение необходимо подтвердить с наблюдателем.

    Вторая проблема возникает в группе 5, где есть дополнительный символ, с дублированным последним символом. Эту проблему можно исправить, удалив лишний символ.

## Завершение работ

Во время упражнений на этом занятии вы импортировали несколько файлов в свой список станций. Перейдите на страницу списка станций и нажмите значки мусорных корзин, чтобы удалить станции. Вам может потребоваться обновить страницу, чтобы станции были удалены из списка после удаления.

<center><img alt="Просмотрщик метаданных станции"
         src="../../assets/img/synop2bufr-trash.png" width="600"></center>

## Заключение

!!! success "Поздравляем!"

    На этом практическом занятии вы узнали:

    - как инструмент synop2bufr может быть использован для преобразования отчетов FM-12 SYNOP в BUFR;
    - как отправить отчет FM-12 SYNOP через веб-приложение;
    - как диагностировать и исправлять простые ошибки в отчете FM-12 SYNOP;
    - важность регистрации станций в wis2box (и OSCAR/Surface);
    - и использование кнопки проверки для просмотра содержимого данных BUFR.